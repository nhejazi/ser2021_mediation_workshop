<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 R packages for estimation of the causal (in)direct effects | [SER 2021 Workshop] Causal Mediation: Modern Methods for Path Analysis</title>
<meta name="author" content="Iván Díaz, Nima Hejazi, Kara Rudolph">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4.9003/tabs.js"></script><script src="libs/bs3compat-0.2.4.9003/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
</head>
<body>
<span class="math inline">
  \(\DeclareMathOperator{\expit}{expit}\)
  \(\DeclareMathOperator{\logit}{logit}\)
  \(\DeclareMathOperator*{\argmin}{\arg\!\min}\)
  \(\newcommand{\indep}{\perp\!\!\!\perp}\)
  \(\newcommand{\coloneqq}{\mathrel{=}}\)
  \(\newcommand{\R}{\mathbb{R}}\)
  \(\newcommand{\E}{\mathbb{E}}\)
  \(\newcommand{\M}{\mathcal{M}}\)
  \(\renewcommand{\P}{\mathbb{P}}\)
  \(\newcommand{\I}{\mathbb{I}}\)
  \(\newcommand{\1}{\mathbbm{1}}\)
  </span>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">[SER 2021 Workshop] Causal Mediation: Modern Methods for Path Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome to SER!</a></li>
<li><a class="" href="mediation.html"><span class="header-section-number">1</span> Causal mediation analysis intro</a></li>
<li><a class="" href="estimands.html"><span class="header-section-number">2</span> Types of path-specific causal mediation effects</a></li>
<li><a class="" href="stochastic.html"><span class="header-section-number">3</span> Stochastic Direct and Indirect Effects</a></li>
<li><a class="" href="estimandirl.html"><span class="header-section-number">4</span> How to choose an estimand: Real-world example</a></li>
<li><a class="" href="preliminaries-on-semiparametric-estimation.html"><span class="header-section-number">5</span> Preliminaries on semiparametric estimation</a></li>
<li><a class="" href="using-the-eif-to-construct-an-estimator-the-case-of-the-natural-direct-effect.html"><span class="header-section-number">6</span> Using the EIF to construct an estimator: the case of the natural direct effect</a></li>
<li><a class="active" href="r-packages-for-estimation-of-the-causal-indirect-effects.html"><span class="header-section-number">7</span> R packages for estimation of the causal (in)direct effects</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/nhejazi/ser2021_mediation_workshop">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="r-packages-for-estimation-of-the-causal-indirect-effects" class="section level1">
<h1>
<span class="header-section-number">7</span> <code>R</code> packages for estimation of the causal (in)direct effects<a class="anchor" aria-label="anchor" href="#r-packages-for-estimation-of-the-causal-indirect-effects"><i class="fas fa-link"></i></a>
</h1>
<p>We’ll now turn to working through a few examples of estimating the natural,
interventional, and stochastic direct and indirect effects. As our running
example, we’ll a simple data set from an observational study of the relationship
between BMI and kids’ behavior, freely distributed with the <a href="https://CRAN.R-project.org/package=mma"><code>mma</code> <code>R</code> package
on CRAN</a>. First, let’s load the packages
we’ll be using and set a seed; then, load this data set and take a quick look</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tlverse.org/sl3">sl3</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nhejazi/medoutcon">medoutcon</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nhejazi/medshift">medshift</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.r-project.org">mma</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">429153</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load and examine data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">weight_behavior</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">weight_behavior</span><span class="op">)</span>
<span class="co">#&gt; [1] 691  15</span>

<span class="co"># drop missing values</span>
<span class="va">weight_behavior</span> <span class="op">&lt;-</span> <span class="va">weight_behavior</span> <span class="op">%&gt;%</span>
  <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span>
<span class="va">weight_behavior</span>
<span class="co">#&gt; # A tibble: 567 x 15</span>
<span class="co">#&gt;     bmi   age sex   race  numpeople   car gotosch snack tvhours cmpthours</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;     &lt;int&gt; &lt;int&gt; &lt;fct&gt;   &lt;fct&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1  18.2  12.2 F     OTHER         5     3 2       1           4         0</span>
<span class="co">#&gt; 2  22.8  12.8 M     OTHER         4     3 2       1           4         2</span>
<span class="co">#&gt; 3  25.6  12.1 M     OTHER         2     3 2       1           0         2</span>
<span class="co">#&gt; 4  15.1  12.3 M     OTHER         4     1 2       1           2         1</span>
<span class="co">#&gt; 5  23.0  11.8 M     OTHER         4     1 1       1           4         3</span>
<span class="co">#&gt; # … with 562 more rows, and 5 more variables: cellhours &lt;dbl&gt;, sports &lt;fct&gt;,</span>
<span class="co">#&gt; #   exercises &lt;int&gt;, sweat &lt;int&gt;, overweigh &lt;dbl&gt;</span></code></pre></div>
<p>The documentation for the data set describes it as a “database obtained from the
Louisiana State University Health Sciences Center, New Orleans, by Dr. Richard
Scribner. He explored the relationship between BMI and kids’ behavior through a
survey at children, teachers and parents in Grenada in 2014. This data set
includes 691 observations and 15 variables.” Note that the data set contained
several observations with missing values, which we removed above to simplify the
demonstration of our analytic methods. In practice, we recommend instead using
appropriate corrections (e.g., imputation, inverse weighting) to fully take
advantage of the observed data.</p>
<p>Following the motivation of the original study, we focus on the causal effects
of participating in a sports team (<code>sports</code>) on the BMI of children (<code>bmi</code>),
taking into consideration several mediators (<code>snack</code>, <code>exercises</code>, <code>overweigh</code>);
all other measured covariates are taken to be potential baseline confounders.</p>
<div id="medoutcon-natural-and-interventional-indirect-effects" class="section level2">
<h2>
<span class="header-section-number">7.1</span> <code>medoutcon</code>: Natural and interventional (in)direct effects<a class="anchor" aria-label="anchor" href="#medoutcon-natural-and-interventional-indirect-effects"><i class="fas fa-link"></i></a>
</h2>
<p>The data on a single observational unit can be represented <span class="math inline">\(O = (W, A, M, Y)\)</span>,
with the data pooled across all participants denoted <span class="math inline">\(O_1, \ldots, O_n\)</span>, for a
of <span class="math inline">\(n\)</span> i.i.d. observations of <span class="math inline">\(O\)</span>. Recall the DAG <a href="estimands.html#estimands">from an earlier
chapter</a>, which represents the data-generating process:</p>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-1"></span>
<img src="07-estimation-stochastic_files/figure-html/unnamed-chunk-1-1.png" alt="Directed acyclic graph under *no intermediate confounders* of the mediator-outcome relation affected by treatment" width="80%"><p class="caption">
FIGURE 2.1: Directed acyclic graph under <em>no intermediate confounders</em> of the mediator-outcome relation affected by treatment
</p>
</div>
<div id="natural-indirect-effects" class="section level3">
<h3>
<span class="header-section-number">7.1.1</span> Natural (in)direct effects<a class="anchor" aria-label="anchor" href="#natural-indirect-effects"><i class="fas fa-link"></i></a>
</h3>
<p>To start, we will consider estimation of the <em>natural</em> direct and indirect effects,
which, we recall, are defined as follows
<span class="math display">\[\begin{equation*}
  \E[Y_{1,M_1} - Y_{0,M_0}] = \underbrace{\E[Y_{\color{red}{1},\color{blue}{M_1}} -
    Y_{\color{red}{1},\color{blue}{M_0}}]}_{\text{natural indirect effect}} +
    \underbrace{\E[Y_{\color{blue}{1},\color{red}{M_0}} -
    Y_{\color{blue}{0},\color{red}{M_0}}]}_{\text{natural direct effect}}.
\end{equation*}\]</span></p>
<ul>
<li>Our <a href="https://github.com/nhejazi/medoutcon"><code>medoutcon</code> <code>R</code> package</a>, which
accompanies <span class="citation">(<span class="citeproc-not-found" data-reference-id="diaz2020nonparametric"><strong>???</strong></span>)</span>, implements one-step and TML estimators of
both the natural and interventional (in)direct effects.</li>
<li>Both types of estimators are capable of accommodating flexible modeling
strategies (e.g., ensemble machine learning) for the initial estimation of
nuisance parameters.</li>
<li>The <code>medoutcon</code> <code>R</code> package uses cross-validation in initial estimation: this
results in cross-validated (or “cross-fitted”) one-step and TML estimators
<span class="citation">(<span class="citeproc-not-found" data-reference-id="klaassen1987consistent"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="zheng2011cross"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="chernozhukov2018double"><strong>???</strong></span>)</span>, which
exhibit greater robustness than their non-sample-splitting analogs.</li>
<li>To this end, <code>medoutcon</code> integrates with the <code>sl3</code> <code>R</code> package, which is
extensively documented in this <a href="https://tlverse.org/tlverse-handbook/sl3">book
chapter</a>.</li>
</ul>
</div>
<div id="interlude-sl3-for-nuisance-parameter-estimation" class="section level3">
<h3>
<span class="header-section-number">7.1.2</span> Interlude: <code>sl3</code> for nuisance parameter estimation<a class="anchor" aria-label="anchor" href="#interlude-sl3-for-nuisance-parameter-estimation"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>To fully take advantage of the one-step and TML estimators, we’d like to rely
on flexible, data adaptive strategies for nuisance parameter estimation.</li>
<li>Doing so minimizes opportunities for model misspecification to compromise our
analytic conclusions.</li>
<li>Choosing among the diversity of available machine learning algorithms can be
challenging, so we recommend using the Super Learner algorithm for ensemble
machine learning <span class="citation">(van der Laan, Polley, and Hubbard <a href="references.html#ref-vdl2007super" role="doc-biblioref">2007</a>)</span>, which is implemented in the <a href="https://github.com/tlverse/sl3"><code>sl3</code> R
package</a>.</li>
<li>Below, we demonstrate the construction of an ensemble learner based on a
limited library of algorithms, including n intercept model, a main terms GLM,
Lasso (<span class="math inline">\(\ell_1\)</span>-penalized) regression, and random forests (<code>ranger</code>).</li>
</ul>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># instantiate learners</span>
<span class="va">mean_lrnr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_mean.html">Lrnr_mean</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">fglm_lrnr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glm_fast.html">Lrnr_glm_fast</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">lasso_lrnr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span>, nfolds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">rf_lrnr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_ranger.html">Lrnr_ranger</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>num.trees <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>

<span class="co"># create learner library and instantiate super learner ensemble</span>
<span class="va">lrnr_lib</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Stack.html">Stack</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">mean_lrnr</span>, <span class="va">fglm_lrnr</span>, <span class="va">lasso_lrnr</span>, <span class="va">rf_lrnr</span><span class="op">)</span>
<span class="va">sl_lrnr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_sl.html">Lrnr_sl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>learners <span class="op">=</span> <span class="va">lrnr_lib</span>, metalearner <span class="op">=</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_nnls.html">Lrnr_nnls</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<ul>
<li>Of course, there are many alternatives for learning algorithms to be included
in such a modeling library. Feel free to explore!</li>
</ul>
</div>
<div id="efficient-estimation-of-the-natural-indirect-effects" class="section level3">
<h3>
<span class="header-section-number">7.1.3</span> Efficient estimation of the natural (in)direct effects<a class="anchor" aria-label="anchor" href="#efficient-estimation-of-the-natural-indirect-effects"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Estimation of the natural direct and indirect effects requires estimation of a
few nuisance parameters. Recall that these are
<ul>
<li>
<span class="math inline">\(g(a\mid w)\)</span>, which denotes <span class="math inline">\(\P(A=a \mid W=w)\)</span>
</li>
<li>
<span class="math inline">\(h(a\mid m, w)\)</span>, which denotes <span class="math inline">\(\P(A=a \mid M=m, W=w)\)</span>
</li>
<li>
<span class="math inline">\(b(a, m, w)\)</span>, which denotes <span class="math inline">\(\E(Y \mid A=a, M=m, W=w)\)</span>
</li>
</ul>
</li>
<li>While we recommend the use of Super Learning, we opt to instead estimate all
nuisance parameters with Lasso regression below (to save computational time).</li>
<li>Now, we’re ready to use the <code>medoutcon</code> function to estimate the <em>natural
direct effect</em>:</li>
</ul>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compute one-step estimate of the natural direct effect</span>
<span class="va">nde_onestep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medoutcon/man/medoutcon.html">medoutcon</a></span><span class="op">(</span>
  W <span class="op">=</span> <span class="va">weight_behavior</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"race"</span>, <span class="st">"tvhours"</span><span class="op">)</span><span class="op">]</span>,
  A <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">weight_behavior</span><span class="op">$</span><span class="va">sports</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,
  Z <span class="op">=</span> <span class="cn">NULL</span>,
  M <span class="op">=</span> <span class="va">weight_behavior</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"snack"</span>, <span class="st">"exercises"</span>, <span class="st">"overweigh"</span><span class="op">)</span><span class="op">]</span>,
  Y <span class="op">=</span> <span class="va">weight_behavior</span><span class="op">$</span><span class="va">bmi</span>,
  g_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  h_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  b_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  effect <span class="op">=</span> <span class="st">"direct"</span>,
  estimator <span class="op">=</span> <span class="st">"onestep"</span>,
  estimator_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cv_folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">nde_onestep</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 7</span>
<span class="co">#&gt;   lwr_ci param_est upr_ci var_est eif_mean estimator param         </span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;         </span>
<span class="co">#&gt; 1 -0.490   -0.0280  0.434  0.0555 2.84e-15 onestep   direct_natural</span></code></pre></div>
<ul>
<li>We can similarly call the <code>medoutcon</code> function to estimate the <em>natural
indirect effect</em>:</li>
</ul>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compute one-step estimate of the natural indirect effect</span>
<span class="va">nie_onestep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medoutcon/man/medoutcon.html">medoutcon</a></span><span class="op">(</span>
  W <span class="op">=</span> <span class="va">weight_behavior</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"race"</span>, <span class="st">"tvhours"</span><span class="op">)</span><span class="op">]</span>,
  A <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">weight_behavior</span><span class="op">$</span><span class="va">sports</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,
  Z <span class="op">=</span> <span class="cn">NULL</span>,
  M <span class="op">=</span> <span class="va">weight_behavior</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"snack"</span>, <span class="st">"exercises"</span>, <span class="st">"overweigh"</span><span class="op">)</span><span class="op">]</span>,
  Y <span class="op">=</span> <span class="va">weight_behavior</span><span class="op">$</span><span class="va">bmi</span>,
  g_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  h_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  b_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  effect <span class="op">=</span> <span class="st">"indirect"</span>,
  estimator <span class="op">=</span> <span class="st">"onestep"</span>,
  estimator_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cv_folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">nie_onestep</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 7</span>
<span class="co">#&gt;   lwr_ci param_est upr_ci var_est eif_mean estimator param           </span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;           </span>
<span class="co">#&gt; 1  0.466      1.09   1.72   0.102 9.02e-16 onestep   indirect_natural</span></code></pre></div>
<ul>
<li>From the above, we can conclude that the effect of participation on a sports
team on BMI is primarily mediated by the variables <code>snack</code>, <code>exercises</code>, and
<code>overweigh</code>, as the natural indirect effect is several times larger than the
natural direct effect.</li>
<li>Note that we could have instead used the TML estimators, which have improved
finite-sample performance, instead of the one-step estimators. Doing this is
as simple as setting the <code>estimator = "tmle"</code> in the relevant argument.</li>
</ul>
</div>
<div id="interventional-indirect-effects-1" class="section level3">
<h3>
<span class="header-section-number">7.1.4</span> Interventional (in)direct effects<a class="anchor" aria-label="anchor" href="#interventional-indirect-effects-1"><i class="fas fa-link"></i></a>
</h3>
<p>Since our knowledge of the system under study is incomplete, we might worry that
one (or more) of the measured variables are not mediators, but, in fact,
intermediate confounders affected by treatment. While the natural (in)direct
effects are not identified in this setting, their interventional (in)direct
counterparts are, as we saw in an earlier section. Recall that both types of
effects are defined by static interventions on the treatment. The interventional
effects are distinguished by their use of a stochastic intervention on the
mediator to aid in their identification.</p>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-2"></span>
<img src="07-estimation-stochastic_files/figure-html/unnamed-chunk-2-1.png" alt="Directed acyclic graph under intermediate confounders of the mediator-outcome relation affected by treatment" width="80%"><p class="caption">
FIGURE 7.1: Directed acyclic graph under intermediate confounders of the mediator-outcome relation affected by treatment
</p>
</div>
<p>Recall that the interventional (in)direct effects are defined via the decomposition:
<span class="math display">\[\begin{equation*}
\E[Y_{1,G_1} - Y_{0,G_0}] = \underbrace{\E[Y_{\color{red}{1},\color{blue}{G_1}} -
    Y_{\color{red}{1},\color{blue}{G_0}}]}_{\text{interventional indirect effect}} +
    \underbrace{\E[Y_{\color{blue}{1},\color{red}{G_0}} -
    Y_{\color{blue}{0},\color{red}{G_0}}]}_{\text{interventional direct effect}}
\end{equation*}\]</span></p>
<ul>
<li>In our data example, we’ll consider the eating of snacks as a potential
intermediate confounder, since one might reasonably hypothesize that
participation on a sports team might subsequently affect snacking, which then
could affect mediators like the amount of exercises and overweight status.</li>
<li>The interventional direct and indirect effects may also be easily estimated
with the <a href="https://github.com/nhejazi/medoutcon"><code>medoutcon</code> <code>R</code> package</a>.</li>
<li>Just as for the natural (in)direct effects, <code>medoutcon</code> implements
cross-validated one-step and TML estimators of the interventional effects.</li>
</ul>
</div>
<div id="efficient-estimation-of-the-interventional-indirect-effects" class="section level3">
<h3>
<span class="header-section-number">7.1.5</span> Efficient estimation of the interventional (in)direct effects<a class="anchor" aria-label="anchor" href="#efficient-estimation-of-the-interventional-indirect-effects"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Estimation of these effects is more complex, so a few additional nuisance
parameters arise when expressing the (more general) EIF for these effects:
<ul>
<li>
<span class="math inline">\(q(z \mid a, w)\)</span>, the conditional density of the intermediate confounders,
conditional only on treatment and baseline covariates;</li>
<li>
<span class="math inline">\(r(z \mid a, m, w)\)</span>, the conditional density of the intermediate
confounders, conditional on mediators, treatment, and baseline covariates.</li>
</ul>
</li>
<li>Note that the implementation in <code>medoutcon</code> is currently limited to settings
with only binary intermediate confounders, i.e., <span class="math inline">\(Z \in \{0, 1\}\)</span>.</li>
<li>Now, we’re ready to use the <code>medoutcon</code> function to estimate the
<em>interventional direct effect</em>:</li>
</ul>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compute one-step estimate of the interventional direct effect</span>
<span class="va">interv_de_onestep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medoutcon/man/medoutcon.html">medoutcon</a></span><span class="op">(</span>
  W <span class="op">=</span> <span class="va">weight_behavior</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"race"</span>, <span class="st">"tvhours"</span><span class="op">)</span><span class="op">]</span>,
  A <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">weight_behavior</span><span class="op">$</span><span class="va">sports</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,
  Z <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">weight_behavior</span><span class="op">$</span><span class="va">snack</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,
  M <span class="op">=</span> <span class="va">weight_behavior</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"exercises"</span>, <span class="st">"overweigh"</span><span class="op">)</span><span class="op">]</span>,
  Y <span class="op">=</span> <span class="va">weight_behavior</span><span class="op">$</span><span class="va">bmi</span>,
  g_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  h_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  b_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  effect <span class="op">=</span> <span class="st">"direct"</span>,
  estimator <span class="op">=</span> <span class="st">"onestep"</span>,
  estimator_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cv_folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">interv_de_onestep</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 7</span>
<span class="co">#&gt;   lwr_ci param_est upr_ci var_est  eif_mean estimator param                </span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;                </span>
<span class="co">#&gt; 1 -0.476   -0.0107  0.454  0.0562 -9.93e-16 onestep   direct_interventional</span></code></pre></div>
<ul>
<li>We can similarly call the <code>medoutcon</code> function to estimate the
<em>interventional indirect effect</em>:</li>
</ul>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compute one-step estimate of the interventional indirect effect</span>
<span class="va">interv_ie_onestep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medoutcon/man/medoutcon.html">medoutcon</a></span><span class="op">(</span>
  W <span class="op">=</span> <span class="va">weight_behavior</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"race"</span>, <span class="st">"tvhours"</span><span class="op">)</span><span class="op">]</span>,
  A <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">weight_behavior</span><span class="op">$</span><span class="va">sports</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,
  Z <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">weight_behavior</span><span class="op">$</span><span class="va">snack</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,
  M <span class="op">=</span> <span class="va">weight_behavior</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"exercises"</span>, <span class="st">"overweigh"</span><span class="op">)</span><span class="op">]</span>,
  Y <span class="op">=</span> <span class="va">weight_behavior</span><span class="op">$</span><span class="va">bmi</span>,
  g_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  h_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  b_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  effect <span class="op">=</span> <span class="st">"indirect"</span>,
  estimator <span class="op">=</span> <span class="st">"onestep"</span>,
  estimator_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cv_folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">interv_ie_onestep</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 7</span>
<span class="co">#&gt;   lwr_ci param_est upr_ci var_est eif_mean estimator param                  </span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;                  </span>
<span class="co">#&gt; 1  0.348     0.952   1.56  0.0950 3.15e-15 onestep   indirect_interventional</span></code></pre></div>
<ul>
<li>From the above, we can conclude that the effect of participation on a sports
team on BMI is largely through the interventional indirect effect (i.e.,
through the pathways involving the mediating variables) rather than via its
direct effect.</li>
<li>Just as before, we could have instead used the TML estimators, instead of the
one-step estimators. Doing this is as simple as setting the
<code>estimator = "tmle"</code> in the relevant argument.</li>
</ul>
</div>
</div>
<div id="medshift-stochastic-indirect-effects" class="section level2">
<h2>
<span class="header-section-number">7.2</span> <code>medshift</code>: Stochastic (in)direct effects<a class="anchor" aria-label="anchor" href="#medshift-stochastic-indirect-effects"><i class="fas fa-link"></i></a>
</h2>
<p>While the analyses using the natural and interventional effects have been
illuminating, we may also go beyond the restrictive static interventions
required to define these (in)direct effects.</p>
<p>We are interested in assessing the population intervention direct effect and
the population intervention indirect effect, based on the effect decomposition
of the population intervention effect introduced in <span class="citation">Dı́az and Hejazi (<a href="references.html#ref-diaz2020causal" role="doc-biblioref">2020</a>)</span>.</p>
<p>Finally, in our analysis, we consider an incremental propensity score
intervention (IPSI), as first proposed by <span class="citation">(<span class="citeproc-not-found" data-reference-id="kennedy2017nonparametric"><strong>???</strong></span>)</span>, wherein the
<em>odds of participating in a sports team</em> is modulated by some fixed amount
(<span class="math inline">\(0 \leq \delta \leq \infty\)</span>) for each individual. Such an intervention may be
interpreted as the effect of a school program that motivates children to
participate in sports teams. To exemplify our approach, we postulate a
motivational intervention that <em>triples the odds</em> of participating in a sports
team for each individual:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">delta_shift_ipsi</span> <span class="op">&lt;-</span> <span class="fl">3</span></code></pre></div>
<div id="decomposing-the-population-intervention-effect" class="section level3">
<h3>
<span class="header-section-number">7.2.1</span> Decomposing the population intervention effect<a class="anchor" aria-label="anchor" href="#decomposing-the-population-intervention-effect"><i class="fas fa-link"></i></a>
</h3>
<p>We may decompose the population intervention effect (PIE) in terms of a
<em>population intervention direct effect</em> (PIDE) and a <em>population
intervention indirect effect</em> (PIIE):
<span class="math display">\[\begin{equation*}
  \overbrace{\mathbb{E}\{Y(A_\delta, Z(A_\delta)) -
    Y(A_\delta, Z)\}}^{\text{PIIE}} +
    \overbrace{\mathbb{E}\{Y(A_\delta, Z) - Y(A, Z)\}}^{\text{PIDE}}.
\end{equation*}\]</span></p>
<p>This decomposition of the PIE as the sum of the population intervention direct
and indirect effects has an interpretation analogous to the corresponding
standard decomposition of the average treatment effect. In the sequel, we will
compute each of the components of the direct and indirect effects above using
appropriate estimators as follows</p>
<ul>
<li>For <span class="math inline">\(\mathbb{E}\{Y(A, Z)\}\)</span>, the sample mean <span class="math inline">\(\frac{1}{n}\sum_{i=1}^n Y_i\)</span> is
sufficient;</li>
<li>for <span class="math inline">\(\mathbb{E}\{Y(A_{\delta}, Z)\}\)</span>, an efficient one-step estimator for the
effect of a joint intervention altering the exposure mechanism but not the
mediation mechanism, as proposed in <span class="citation">Dı́az and Hejazi (<a href="references.html#ref-diaz2020causal" role="doc-biblioref">2020</a>)</span>; and,</li>
<li>for <span class="math inline">\(\mathbb{E}\{Y(A_{\delta}, Z_{A_{\delta}})\}\)</span>, an efficient one-step
estimator for the effect of a joint intervention altering both the exposure
and mediation mechanisms, as proposed in <span class="citation">(<span class="citeproc-not-found" data-reference-id="kennedy2017nonparametric"><strong>???</strong></span>)</span> and
implemented in the <a href="https://github.com/ehkennedy/npcausal"><code>npcausal</code> R
package</a>.</li>
</ul>
</div>
<div id="estimating-the-effect-decomposition-term" class="section level3">
<h3>
<span class="header-section-number">7.2.2</span> Estimating the effect decomposition term<a class="anchor" aria-label="anchor" href="#estimating-the-effect-decomposition-term"><i class="fas fa-link"></i></a>
</h3>
<p>As given in <span class="citation">Dı́az and Hejazi (<a href="references.html#ref-diaz2020causal" role="doc-biblioref">2020</a>)</span>, the statistical functional identifying the
decomposition term that appears in both the PIDE and PIIE
<span class="math inline">\(\mathbb{E}\{Y(A_{\delta}, Z)\}\)</span>, which corresponds to altering the exposure
mechanism while keeping the mediation mechanism fixed, is
<span class="math display">\[\begin{equation*}
  \theta_0(\delta) = \int m_0(a, z, w) g_{0,\delta}(a \mid w) p_0(z, w)
    d\nu(a, z, w),
\end{equation*}\]</span>
for which a one-step estimator is available. The corresponding <em>efficient
influence function</em> (EIF) with respect to the nonparametric model <span class="math inline">\(\mathcal{M}\)</span>
is <span class="math inline">\(D_{\eta,\delta}(o) = D^Y_{\eta,\delta}(o) + D^A_{\eta,\delta}(o) + D^{Z,W}_{\eta,\delta}(o) - \theta(\delta)\)</span>. The
one-step estimator may be computed using the EIF estimating equation, making use
of cross-fitting <span class="citation">(<span class="citeproc-not-found" data-reference-id="zheng2011cross"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="chernozhukov2018double"><strong>???</strong></span>)</span> to circumvent any
need for entropy conditions (i.e., Donsker class restrictions). The resultant
estimator is
<span class="math display">\[\begin{equation*}
  \hat{\theta}(\delta) = \frac{1}{n} \sum_{i = 1}^n D_{\hat{\eta}_{j(i)},
  \delta}(O_i) = \frac{1}{n} \sum_{i = 1}^n \left\{ D^Y_{\hat{\eta}_{j(i)},
  \delta}(O_i) + D^A_{\hat{\eta}_{j(i)}, \delta}(O_i) +
  D^{Z,W}_{\hat{\eta}_{j(i)}, \delta}(O_i) \right\},
\end{equation*}\]</span>
which is implemented in the <code>medshift</code> R package. We make use of that
implementation to estimate <span class="math inline">\(\mathbb{E}\{Y(A_{\delta}, Z)\}\)</span> via its one-step
estimator <span class="math inline">\(\hat{\theta}(\delta)\)</span> below</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># let's compute the parameter where A (but not Z) are shifted</span>
<span class="va">pide_decomp_onestep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/medshift/man/medshift.html">medshift</a></span><span class="op">(</span>
  W <span class="op">=</span> <span class="va">W</span>, A <span class="op">=</span> <span class="va">A</span>, Z <span class="op">=</span> <span class="va">Z</span>, Y <span class="op">=</span> <span class="va">Y</span>,
  delta <span class="op">=</span> <span class="va">delta_shift_ipsi</span>,
  g_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  e_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  m_learners <span class="op">=</span> <span class="va">lasso_lrnr</span>,
  estimator <span class="op">=</span> <span class="st">"onestep"</span>,
  estimator_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cv_folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pide_decomp_onestep</span><span class="op">)</span></code></pre></div>
</div>
<div id="estimating-the-direct-effect" class="section level3">
<h3>
<span class="header-section-number">7.2.3</span> Estimating the direct effect<a class="anchor" aria-label="anchor" href="#estimating-the-direct-effect"><i class="fas fa-link"></i></a>
</h3>
<p>Recall that, based on the decomposition outlined previously, the population
intervention direct effect may be denoted <span class="math inline">\(\beta_{\text{PIDE}}(\delta) = \theta_0(\delta) - \mathbb{E}Y\)</span>. Thus, an estimator of the PIDE,
<span class="math inline">\(\hat{\beta}_{\text{PIDE}}(\delta)\)</span> may be expressed as a composition of
estimators of its constituent parameters:
<span class="math display">\[\begin{equation*}
  \hat{\beta}_{\text{PIDE}}({\delta}) = \hat{\theta}(\delta) -
  \frac{1}{n} \sum_{i = 1}^n Y_i.
\end{equation*}\]</span></p>
<p>Based on the above, we may construct an estimator of the PIDE using quantities
already computed. The convenience function below applies the simple delta method
required in the case of a linear contrast between the two constituent
parameters:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># convenience function to compute inference via delta method: EY1 - EY0</span>
<span class="va">linear_contrast</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">eifs</span>, <span class="va">ci_level</span> <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># bounds for confidence interval</span>
  <span class="va">ci_norm_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span>p <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">ci_level</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
  <span class="va">param_est</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">params</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
  <span class="va">eif</span> <span class="op">&lt;-</span> <span class="va">eifs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">eifs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
  <span class="va">se_eif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">eif</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">eif</span><span class="op">)</span><span class="op">)</span>
  <span class="va">param_ci</span> <span class="op">&lt;-</span> <span class="va">param_est</span> <span class="op">+</span> <span class="va">ci_norm_bounds</span> <span class="op">*</span> <span class="va">se_eif</span>
  <span class="co"># parameter and inference</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">param_ci</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">param_est</span>, <span class="va">param_ci</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lwr_ci"</span>, <span class="st">"param_est"</span>, <span class="st">"upr_ci"</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>With the above convenience function in hand, we’ll construct or extract the
necessary components from existing objects and simply apply the function:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># parameter estimates and EIFs for components of direct effect</span>
<span class="va">EY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>
<span class="va">eif_EY</span> <span class="op">&lt;-</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">EY</span>
<span class="va">params_de</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">theta_eff</span><span class="op">$</span><span class="va">theta</span>, <span class="va">EY</span><span class="op">)</span>
<span class="va">eifs_de</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">theta_eff</span><span class="op">$</span><span class="va">eif</span>, <span class="va">eif_EY</span><span class="op">)</span>

<span class="co"># direct effect = EY - estimated quantity</span>
<span class="va">de_est</span> <span class="op">&lt;-</span> <span class="fu">linear_contrast</span><span class="op">(</span><span class="va">params_de</span>, <span class="va">eifs_de</span><span class="op">)</span>
<span class="va">de_est</span></code></pre></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="using-the-eif-to-construct-an-estimator-the-case-of-the-natural-direct-effect.html"><span class="header-section-number">6</span> Using the EIF to construct an estimator: the case of the natural direct effect</a></div>
<div class="next"><a href="references.html">References</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#r-packages-for-estimation-of-the-causal-indirect-effects"><span class="header-section-number">7</span> R packages for estimation of the causal (in)direct effects</a></li>
<li>
<a class="nav-link" href="#medoutcon-natural-and-interventional-indirect-effects"><span class="header-section-number">7.1</span> medoutcon: Natural and interventional (in)direct effects</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#natural-indirect-effects"><span class="header-section-number">7.1.1</span> Natural (in)direct effects</a></li>
<li><a class="nav-link" href="#interlude-sl3-for-nuisance-parameter-estimation"><span class="header-section-number">7.1.2</span> Interlude: sl3 for nuisance parameter estimation</a></li>
<li><a class="nav-link" href="#efficient-estimation-of-the-natural-indirect-effects"><span class="header-section-number">7.1.3</span> Efficient estimation of the natural (in)direct effects</a></li>
<li><a class="nav-link" href="#interventional-indirect-effects-1"><span class="header-section-number">7.1.4</span> Interventional (in)direct effects</a></li>
<li><a class="nav-link" href="#efficient-estimation-of-the-interventional-indirect-effects"><span class="header-section-number">7.1.5</span> Efficient estimation of the interventional (in)direct effects</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#medshift-stochastic-indirect-effects"><span class="header-section-number">7.2</span> medshift: Stochastic (in)direct effects</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#decomposing-the-population-intervention-effect"><span class="header-section-number">7.2.1</span> Decomposing the population intervention effect</a></li>
<li><a class="nav-link" href="#estimating-the-effect-decomposition-term"><span class="header-section-number">7.2.2</span> Estimating the effect decomposition term</a></li>
<li><a class="nav-link" href="#estimating-the-direct-effect"><span class="header-section-number">7.2.3</span> Estimating the direct effect</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/nhejazi/ser2021_mediation_workshop/blob/master/07-estimation-stochastic.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/nhejazi/ser2021_mediation_workshop/edit/master/07-estimation-stochastic.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>[SER 2021 Workshop] Causal Mediation: Modern Methods for Path Analysis</strong>" was written by Iván Díaz, Nima Hejazi, Kara Rudolph. It was last built on updated: May 17, 2021.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
