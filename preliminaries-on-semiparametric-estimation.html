<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Preliminaries on semiparametric estimation | [SER 2021 Workshop] Causal Mediation: Modern Methods for Path Analysis</title>
<meta name="author" content="Iván Díaz, Nima Hejazi, Kara Rudolph">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4.9003/tabs.js"></script><script src="libs/bs3compat-0.2.4.9003/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
</head>
<body>
<span class="math inline">
  \(\DeclareMathOperator{\expit}{expit}\)
  \(\DeclareMathOperator{\logit}{logit}\)
  \(\DeclareMathOperator*{\argmin}{\arg\!\min}\)
  \(\newcommand{\indep}{\perp\!\!\!\perp}\)
  \(\newcommand{\coloneqq}{\mathrel{=}}\)
  \(\newcommand{\R}{\mathbb{R}}\)
  \(\newcommand{\E}{\mathbb{E}}\)
  \(\newcommand{\M}{\mathcal{M}}\)
  \(\renewcommand{\P}{\mathbb{P}}\)
  \(\newcommand{\I}{\mathbb{I}}\)
  \(\newcommand{\1}{\mathbbm{1}}\)
  </span>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">[SER 2021 Workshop] Causal Mediation: Modern Methods for Path Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome to SER!</a></li>
<li><a class="" href="mediation.html"><span class="header-section-number">1</span> Causal mediation analysis intro</a></li>
<li><a class="" href="estimands.html"><span class="header-section-number">2</span> Types of path-specific causal mediation effects</a></li>
<li><a class="" href="stochastic.html"><span class="header-section-number">3</span> Stochastic Direct and Indirect Effects</a></li>
<li><a class="" href="estimandirl.html"><span class="header-section-number">4</span> How to choose an estimand: Real-world example</a></li>
<li><a class="active" href="preliminaries-on-semiparametric-estimation.html"><span class="header-section-number">5</span> Preliminaries on semiparametric estimation</a></li>
<li><a class="" href="using-the-eif-to-construct-an-estimator-the-case-of-the-natural-direct-effect.html"><span class="header-section-number">6</span> Using the EIF to construct an estimator: the case of the natural direct effect</a></li>
<li><a class="" href="r-packages-for-estimation-of-the-causal-indirect-effects.html"><span class="header-section-number">7</span> R packages for estimation of the causal (in)direct effects</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/nhejazi/ser2021_mediation_workshop">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="preliminaries-on-semiparametric-estimation" class="section level1">
<h1>
<span class="header-section-number">5</span> Preliminaries on semiparametric estimation<a class="anchor" aria-label="anchor" href="#preliminaries-on-semiparametric-estimation"><i class="fas fa-link"></i></a>
</h1>
<div id="from-causal-to-statistical-quantities" class="section level2">
<h2>
<span class="header-section-number">5.1</span> From causal to statistical quantities<a class="anchor" aria-label="anchor" href="#from-causal-to-statistical-quantities"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>We have arrived at identification formulas that express quantities that we
care about in terms of observable quantities</li>
<li>This required <strong>causal assumptions</strong>
<ul>
<li>Many of these assumptions are empirically unverifiable</li>
<li>We saw an example where we could relax the cross-world assumption, at the
cost of changing the parameter interpretation</li>
<li>and where we could relax the positivity assumption, also at the cost of
changing the parameter interpretation</li>
</ul>
</li>
<li>The resulting estimation problem can be tackled using <strong>statistical
assumptions</strong> of various degrees of strength
<ul>
<li>Most of these assumptions are verifiable (e.g., a linear model)</li>
<li>Thus, most are unnecessary (except for convenience)</li>
<li>The estimation approach we use reduces reliance on these statistical
assumptions</li>
</ul>
</li>
</ul>
<div id="computing-identification-formulas-if-you-know-the-true-distribution" class="section level3">
<h3>
<span class="header-section-number">5.1.1</span> Computing identification formulas if you know the true distribution<a class="anchor" aria-label="anchor" href="#computing-identification-formulas-if-you-know-the-true-distribution"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>The mediation parameters that we consider can be
seen as a function of the joint probability distribution of <span class="math inline">\(O=(W,A,Z,M,Y)\)</span>
</li>
<li>For example, under identifiability assumptions the natural direct effect is
equal to
<span class="math display">\[\begin{equation*}
  \psi(\P) =  \E[\E\{\E(Y \mid A=1, M, W) - \E(Y \mid A=0, M, W)\mid A=0,W\}]
\end{equation*}\]</span>
</li>
<li>The notation <span class="math inline">\(\psi(\P)\)</span> implies that the parameter is a function of <span class="math inline">\(\P\)</span>
</li>
<li>This means that we can compute it for any distribution <span class="math inline">\(\P\)</span>
</li>
<li>For example, if we know the true <span class="math inline">\(\P(W,A,M,Y)\)</span>, we can comnpute the true value
of the parameter by:
<ul>
<li>Computing the conditional expectation <span class="math inline">\(\E(Y\mid A=1,M=m,W=w)\)</span> for all
values <span class="math inline">\((m,w)\)</span>
</li>
<li>Computing the probability <span class="math inline">\(\P(M=m\mid A=0,W=w)\)</span> for all values <span class="math inline">\((m,w)\)</span>
</li>
<li>Computing the probability <span class="math inline">\(\P(W=w)\)</span> for all values <span class="math inline">\(w\)</span>
</li>
<li>Computing the mean over all values <span class="math inline">\((m,w)\)</span>
</li>
</ul>
</li>
</ul>
</div>
<div id="estimating-identification-formulas" class="section level3">
<h3>
<span class="header-section-number">5.1.2</span> Estimating identification formulas<a class="anchor" aria-label="anchor" href="#estimating-identification-formulas"><i class="fas fa-link"></i></a>
</h3>
<p>The above is how you would compute the <em>true value</em> <strong>if you know</strong> the true
distribution <span class="math inline">\(\P\)</span></p>
<ul>
<li>This is exactly what we did in our R examples before</li>
<li>But we can use the same logic for estimation:
<ul>
<li>Fit a regression to estimate, say <span class="math inline">\(\hat\E(Y\mid A=1,M=m,W=w)\)</span>
</li>
<li>Fit a regression to estimate, say <span class="math inline">\(\hat\P(M=m\mid A=0,W=w)\)</span>
</li>
<li>Estimate <span class="math inline">\(\P(W=w)\)</span> with the empirical distribution</li>
<li>Evaluate
<span class="math display">\[\begin{equation*}
  \psi(\hat\P) =  \hat\E[\hat\E\{\hat\E(Y \mid A=1, M, W) -
  \hat\E(Y \mid A=0, M, W)\mid A=0,W\}]
\end{equation*}\]</span>
</li>
</ul>
</li>
<li>This is known as the g-computation estimator</li>
</ul>
</div>
<div id="how-can-g-estimation-be-implemented-in-practice" class="section level3">
<h3>
<span class="header-section-number">5.1.3</span> How can g-estimation be implemented in practice?<a class="anchor" aria-label="anchor" href="#how-can-g-estimation-be-implemented-in-practice"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>There are two possible ways to do g-computation estimation:
<ul>
<li>Using parametric models for the above regressions</li>
<li>Using flexible data-adaptive regression (aka machine learning)</li>
</ul>
</li>
</ul>
</div>
<div id="pros-and-cons-of-parametric-models" class="section level3">
<h3>
<span class="header-section-number">5.1.4</span> Pros and cons of parametric models<a class="anchor" aria-label="anchor" href="#pros-and-cons-of-parametric-models"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Pros:
<ul>
<li>Easy to understand</li>
<li>Ease of implementation (standard regression software)</li>
<li>Can use the Delta method or the bootstrap for computation of standard errors</li>
</ul>
</li>
<li>Cons:
<ul>
<li>Unless <span class="math inline">\(W\)</span> and <span class="math inline">\(M\)</span> contain very few categorical variables, it is very easy
to misspecify the models</li>
<li>This can introduce sizable bias in the estimators</li>
</ul>
</li>
</ul>
</div>
<div id="an-example-of-the-bias-of-a-g-computation-estimator-of-the-natural-direct-effect" class="section level3">
<h3>
<span class="header-section-number">5.1.5</span> An example of the bias of a g-computation estimator of the natural direct effect<a class="anchor" aria-label="anchor" href="#an-example-of-the-bias-of-a-g-computation-estimator-of-the-natural-direct-effect"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>The following <code>R</code> chunk provides simulation code to exemplify the bias of a
g-computation estimator in a simple situation</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mean_y</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span>, <span class="va">a</span>, <span class="va">w</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="op">+</span> <span class="va">a</span> <span class="op">*</span> <span class="va">m</span>
<span class="va">mean_m</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">w</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">w</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">a</span><span class="op">)</span>
<span class="va">pscore</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<ul>
<li>This yields a true NDE value of</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w_big</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1e6</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">trueval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fu">mean_y</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">w_big</span><span class="op">)</span> <span class="op">-</span> <span class="fu">mean_y</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">w_big</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span>
  <span class="fu">mean_m</span><span class="op">(</span><span class="fl">0</span>, <span class="va">w_big</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fu">mean_y</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="va">w_big</span><span class="op">)</span> <span class="op">-</span> <span class="fu">mean_y</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="va">w_big</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span>
    <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu">mean_m</span><span class="op">(</span><span class="fl">0</span>, <span class="va">w_big</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">trueval</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.58048</span></code></pre></div>
<ul>
<li>Let’s perform a simulation where we draw 1000 datasets from the above
distribution, and compute a g-computation estimator based on</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gcomp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">m</span>, <span class="va">a</span>, <span class="va">w</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">lm_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">m</span> <span class="op">+</span> <span class="va">a</span> <span class="op">+</span> <span class="va">w</span><span class="op">)</span>
  <span class="va">pred_y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_y</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, m <span class="op">=</span> <span class="va">m</span>, w <span class="op">=</span> <span class="va">w</span><span class="op">)</span><span class="op">)</span>
  <span class="va">pred_y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_y</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, m <span class="op">=</span> <span class="va">m</span>, w <span class="op">=</span> <span class="va">w</span><span class="op">)</span><span class="op">)</span>
  <span class="va">pseudo</span> <span class="op">&lt;-</span> <span class="va">pred_y1</span> <span class="op">-</span> <span class="va">pred_y0</span>
  <span class="va">lm_pseudo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">pseudo</span> <span class="op">~</span> <span class="va">a</span> <span class="op">+</span> <span class="va">w</span><span class="op">)</span>
  <span class="va">pred_pseudo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_pseudo</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, w <span class="op">=</span> <span class="va">w</span><span class="op">)</span><span class="op">)</span>
  <span class="va">estimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pred_pseudo</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">estimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">iter</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
  <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu">pscore</span><span class="op">(</span><span class="va">w</span><span class="op">)</span><span class="op">)</span>
  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu">mean_m</span><span class="op">(</span><span class="va">a</span>, <span class="va">w</span><span class="op">)</span><span class="op">)</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fu">mean_y</span><span class="op">(</span><span class="va">m</span>, <span class="va">a</span>, <span class="va">w</span><span class="op">)</span><span class="op">)</span>
  <span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">gcomp</span><span class="op">(</span><span class="va">y</span>, <span class="va">m</span>, <span class="va">a</span>, <span class="va">w</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">estimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="va">estimate</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">trueval</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-preliminaries-estimation_files/figure-html/unnamed-chunk-4-1.png" width="80%" style="display: block; margin: auto;"></div>
<ul>
<li>The bias also affects the confidence intervals:</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>
  <span class="va">estimate</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,
  <span class="va">estimate</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">cis</span><span class="op">)</span><span class="op">)</span>
<span class="va">lower</span> <span class="op">&lt;-</span> <span class="va">cis</span><span class="op">[</span><span class="va">ord</span>, <span class="fl">1</span><span class="op">]</span>
<span class="va">upper</span> <span class="op">&lt;-</span> <span class="va">cis</span><span class="op">[</span><span class="va">ord</span>, <span class="fl">2</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span><span class="va">trueval</span> <span class="op">+</span> <span class="fl">0</span> <span class="op">*</span> <span class="va">x</span>,
  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1001</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">3</span>, xaxt <span class="op">=</span> <span class="st">"n"</span>,
  xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">"Confidence interval"</span>, cex.axis <span class="op">=</span> <span class="fl">1.2</span>, cex.lab <span class="op">=</span> <span class="fl">1.2</span>
<span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">clr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.75</span>, <span class="fl">0.5</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">upper</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">trueval</span> <span class="op">||</span> <span class="va">lower</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">trueval</span><span class="op">)</span> <span class="va">clr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">i</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lower</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">upper</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">clr</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">450</span>, <span class="fl">0.10</span>, <span class="st">"n=1000 repetitions = 1000 "</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">450</span>, <span class="fl">0.01</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span>
  <span class="st">"Coverage probability = "</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lower</span> <span class="op">&lt;</span> <span class="va">trueval</span> <span class="op">&amp;</span> <span class="va">trueval</span> <span class="op">&lt;</span> <span class="va">upper</span><span class="op">)</span>, <span class="st">"%"</span>
<span class="op">)</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-preliminaries-estimation_files/figure-html/unnamed-chunk-5-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
<div id="pros-and-cons-of-g-computation-with-data-adaptive-regression" class="section level3">
<h3>
<span class="header-section-number">5.1.6</span> Pros and cons of g-computation with data-adaptive regression<a class="anchor" aria-label="anchor" href="#pros-and-cons-of-g-computation-with-data-adaptive-regression"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Pros:
<ul>
<li>Easy to understand</li>
<li>Alleviate model-misspecification bias</li>
</ul>
</li>
<li>Cons:
<ul>
<li>Might be harder to implement depending on the regression procedures used</li>
<li>No general approaches for computation of standard errors and confidence
intervals</li>
<li>For example, the bootstrap is not guaranteed to work, and it is known to
fail in some cases</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="semiparametric-estimation-or-correcting-the-bias-of-g-computation-estimators" class="section level2">
<h2>
<span class="header-section-number">5.2</span> Semiparametric estimation (or correcting the bias of g-computation estimators)<a class="anchor" aria-label="anchor" href="#semiparametric-estimation-or-correcting-the-bias-of-g-computation-estimators"><i class="fas fa-link"></i></a>
</h2>
<!--
KER this may be just me, but I'm not sure the "incorrect bias/variance
tradeoff" argument will be super concrete for folks. I think maybe a more
concrete/motivating argument would be to say that we want to use data adaptive
methods because we don't know how to correctly specify all our models. we also
want valid standard errors and confidence intervals. to do this, we need to use
semiparametric estimation
-->
<ul>
<li>G-computation estimation with data-adaptive regression offers an incorrect
bias/variance trade-off</li>
<li>It accepts more bias than necessary</li>
<li>The bias of a g-computation estimator may be corrected as follows:
<span class="math display">\[\begin{equation*}
  \psi(\hat \P) + \frac{1}{n}\sum_{i=1}^n D(O_i)
\end{equation*}\]</span>
for some function <span class="math inline">\(D(O_i)\)</span> of the data</li>
<li>The function <span class="math inline">\(D(O)\)</span> is called <em>the efficient influence function</em> (EIF)</li>
<li>The EIF must be found on a case-by-case basis for each parameter <span class="math inline">\(\psi(\P)\)</span>
</li>
<li>For example, for estimating the standardized mean <span class="math inline">\(\psi(\P)=\E[\E(Y\mid A=1, W)]\)</span>, we have
<span class="math display">\[\begin{equation*}
  D(O) = \frac{A}{\hat \P(A=1\mid W)}[Y - \hat\E(Y\mid A=1, W)] +
  \hat\E(Y\mid A=1, W) - \psi(\hat\P)
\end{equation*}\]</span>
</li>
<li>The EIF is found by using a distributional analogue of a Taylor expansion</li>
<li>In this workshop we will omit the specific form of <span class="math inline">\(D(O)\)</span> for
some of the parameters that we use</li>
<li>But the estimators we discuss and implement in the R packages will be based on
these EIFs</li>
<li>And the specific form of the EIF may be found in papers in the references</li>
</ul>
<p>Note: the bias correction above may have an additional problem of returning
parameter estimates outside of natural bounds. E.g., probabilities greater than
one. A solution to this (not discussed in this workshop) is targeted minimum
loss based estimation.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="estimandirl.html"><span class="header-section-number">4</span> How to choose an estimand: Real-world example</a></div>
<div class="next"><a href="using-the-eif-to-construct-an-estimator-the-case-of-the-natural-direct-effect.html"><span class="header-section-number">6</span> Using the EIF to construct an estimator: the case of the natural direct effect</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#preliminaries-on-semiparametric-estimation"><span class="header-section-number">5</span> Preliminaries on semiparametric estimation</a></li>
<li>
<a class="nav-link" href="#from-causal-to-statistical-quantities"><span class="header-section-number">5.1</span> From causal to statistical quantities</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#computing-identification-formulas-if-you-know-the-true-distribution"><span class="header-section-number">5.1.1</span> Computing identification formulas if you know the true distribution</a></li>
<li><a class="nav-link" href="#estimating-identification-formulas"><span class="header-section-number">5.1.2</span> Estimating identification formulas</a></li>
<li><a class="nav-link" href="#how-can-g-estimation-be-implemented-in-practice"><span class="header-section-number">5.1.3</span> How can g-estimation be implemented in practice?</a></li>
<li><a class="nav-link" href="#pros-and-cons-of-parametric-models"><span class="header-section-number">5.1.4</span> Pros and cons of parametric models</a></li>
<li><a class="nav-link" href="#an-example-of-the-bias-of-a-g-computation-estimator-of-the-natural-direct-effect"><span class="header-section-number">5.1.5</span> An example of the bias of a g-computation estimator of the natural direct effect</a></li>
<li><a class="nav-link" href="#pros-and-cons-of-g-computation-with-data-adaptive-regression"><span class="header-section-number">5.1.6</span> Pros and cons of g-computation with data-adaptive regression</a></li>
</ul>
</li>
<li><a class="nav-link" href="#semiparametric-estimation-or-correcting-the-bias-of-g-computation-estimators"><span class="header-section-number">5.2</span> Semiparametric estimation (or correcting the bias of g-computation estimators)</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/nhejazi/ser2021_mediation_workshop/blob/master/05-preliminaries-estimation.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/nhejazi/ser2021_mediation_workshop/edit/master/05-preliminaries-estimation.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>[SER 2021 Workshop] Causal Mediation: Modern Methods for Path Analysis</strong>" was written by Iván Díaz, Nima Hejazi, Kara Rudolph. It was last built on updated: May 17, 2021.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
