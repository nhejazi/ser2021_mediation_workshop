<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 1 Causal mediation analysis intro | [SER 2021 Workshop] Causal Mediation: Modern Methods for Path Analysis</title>
<meta name="author" content="Iván Díaz, Nima Hejazi, Kara Rudolph">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4.9003/tabs.js"></script><script src="libs/bs3compat-0.2.4.9003/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
</head>
<body>
<span class="math inline">
  \(\DeclareMathOperator{\expit}{expit}\)
  \(\DeclareMathOperator{\logit}{logit}\)
  \(\DeclareMathOperator*{\argmin}{\arg\!\min}\)
  \(\newcommand{\indep}{\perp\!\!\!\perp}\)
  \(\newcommand{\coloneqq}{\mathrel{=}}\)
  \(\newcommand{\R}{\mathbb{R}}\)
  \(\newcommand{\E}{\mathbb{E}}\)
  \(\newcommand{\M}{\mathcal{M}}\)
  \(\renewcommand{\P}{\mathbb{P}}\)
  \(\newcommand{\I}{\mathbb{I}}\)
  \(\newcommand{\1}{\mathbbm{1}}\)
  </span>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">[SER 2021 Workshop] Causal Mediation: Modern Methods for Path Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome to SER!</a></li>
<li><a class="active" href="mediation.html"><span class="header-section-number">1</span> Causal mediation analysis intro</a></li>
<li><a class="" href="estimands.html"><span class="header-section-number">2</span> Types of path-specific causal mediation effects</a></li>
<li><a class="" href="stochastic.html"><span class="header-section-number">3</span> Stochastic Direct and Indirect Effects</a></li>
<li><a class="" href="estimandirl.html"><span class="header-section-number">4</span> How to choose an estimand: Real-world example</a></li>
<li><a class="" href="preliminaries-on-semiparametric-estimation.html"><span class="header-section-number">5</span> Preliminaries on semiparametric estimation</a></li>
<li><a class="" href="using-the-eif-to-construct-an-estimator-the-case-of-the-natural-direct-effect.html"><span class="header-section-number">6</span> Using the EIF to construct an estimator: the case of the natural direct effect</a></li>
<li><a class="" href="r-packages-for-estimation-of-the-causal-indirect-effects.html"><span class="header-section-number">7</span> R packages for estimation of the causal (in)direct effects</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/nhejazi/ser2021_mediation_workshop">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="mediation" class="section level1">
<h1>
<span class="header-section-number">1</span> Causal mediation analysis intro<a class="anchor" aria-label="anchor" href="#mediation"><i class="fas fa-link"></i></a>
</h1>
<div id="motivating-study" class="section level2">
<h2>
<span class="header-section-number">1.1</span> Motivating study<a class="anchor" aria-label="anchor" href="#motivating-study"><i class="fas fa-link"></i></a>
</h2>
<p>Do differences in the effects of treatment (comparing two medications for opioid
use disorder, naltrexone vs buprenorphine) on risk of relapse operate through
mediators of adherence, opioid use, pain, and depressive symptoms?
<span class="citation">(Rudolph et al. <a href="references.html#ref-rudolph2020explaining" role="doc-biblioref">2020</a>)</span>
<!--
ID: Need to fix format of the following figure
--></p>
<div class="inline-figure"><img src="img/ctndag.png" width="50%" style="display: block; margin: auto;"></div>
</div>
<div id="what-is-causal-mediation-analysis" class="section level2">
<h2>
<span class="header-section-number">1.2</span> What is causal mediation analysis?<a class="anchor" aria-label="anchor" href="#what-is-causal-mediation-analysis"><i class="fas fa-link"></i></a>
</h2>
<!--
KER: I think the tone can come off as smug sometimes, so I'd like to delete
some of this. I also made some edits, but I still think it's worth thinking
about what is crucial to include vs not.
-->
<ul>
<li>Causal mediation analyses assess how the paths behave under interventions</li>
<li>Statistical mediation analyses assess associations between the variables
<!--- Causal mediation analysis is thus useful to understand mechanisms-->
</li>
</ul>
<div id="why-are-the-methods-that-we-will-discuss-today-important" class="section level3">
<h3>
<span class="header-section-number">1.2.1</span> Why are the methods that we will discuss today important?<a class="anchor" aria-label="anchor" href="#why-are-the-methods-that-we-will-discuss-today-important"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Assume you are interested in the effect of a treatment assignment <span class="math inline">\(A\)</span>
(naltrexone vs. buprenorphine) on an outcome <span class="math inline">\(Y\)</span> (risk of relapse) through
mediators <span class="math inline">\(M\)</span> (opioid use, pain, depressive symptoms)</li>
<li>We have pre-treatment confounders <span class="math inline">\(W\)</span>
</li>
<li>There is a confounder <span class="math inline">\(Z\)</span> of <span class="math inline">\(M\rightarrow Y\)</span> ffected by treatment assignment
(adherence)</li>
<li>We could fit the following models:
<span class="math display">\[\begin{align}
    \E(M\mid A=a, W=w, Z=z) &amp; = \gamma_0 + \gamma_1 a + \gamma_2 w + \gamma_3 z \\
    \E(Y\mid M=m, A=a, W=w, Z=z) &amp; = \beta_0 + \beta_1 m + \beta_2 a + \beta_3 w + \beta_4 z
  \end{align}\]</span>
</li>
<li>The product <span class="math inline">\((\gamma_1\beta_1)\)</span> has been proposed as a measure of the effect
of <span class="math inline">\(A\)</span> on <span class="math inline">\(Y\)</span> through <span class="math inline">\(M\)</span>
</li>
<li>Causal interpretation problems with this method:
<ul>
<li>We will see that this parameter cannot be interpreted as a causal effect</li>
</ul>
</li>
</ul>
</div>
<div id="r-example" class="section level3">
<h3>
<span class="header-section-number">1.2.2</span> <code>R</code> Example:<a class="anchor" aria-label="anchor" href="#r-example"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Assume we have a pre-treamtment confounder of <span class="math inline">\(Y\)</span> and <span class="math inline">\(M\)</span>, denote it with <span class="math inline">\(W\)</span>
</li>
<li>For simplicity, assume <span class="math inline">\(A\)</span> is randomized</li>
<li>We’ll generate a really large sample from a data generating mechanism so that
we are not concerned with sampling errors</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1e6</span>
<span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>
<span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.2</span> <span class="op">*</span> <span class="va">a</span> <span class="op">+</span> <span class="fl">0.3</span><span class="op">)</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">w</span> <span class="op">+</span> <span class="va">z</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">m</span> <span class="op">+</span> <span class="va">w</span> <span class="op">-</span> <span class="va">a</span> <span class="op">+</span> <span class="va">z</span><span class="op">)</span></code></pre></div>
<ul>
<li>Note that the indirect effect (i.e., the effect through <span class="math inline">\(M\)</span>) in this example
is nonzero (there is a pathway <span class="math inline">\(A\rightarrow Z \rightarrow M \rightarrow Y\)</span>)</li>
<li>Let’s see what the product of coefficients method would say:</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">m</span> <span class="op">+</span> <span class="va">a</span> <span class="op">+</span> <span class="va">w</span> <span class="op">+</span> <span class="va">z</span><span class="op">)</span>
<span class="va">lm_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">m</span> <span class="op">~</span> <span class="va">a</span> <span class="op">+</span> <span class="va">w</span> <span class="op">+</span> <span class="va">z</span><span class="op">)</span>
<span class="co">## product of coefficients</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lm_y</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lm_m</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="co">#&gt;          m </span>
<span class="co">#&gt; -0.0014835</span></code></pre></div>
<p>Among other things, in this workshop:</p>
<ul>
<li>We will provide some understanding for why the above method fails in this
example</li>
<li>We will study estimators that are robust to misspecification in the above
models</li>
</ul>
</div>
</div>
<div id="causal-mediation-models" class="section level2">
<h2>
<span class="header-section-number">1.3</span> Causal mediation models<a class="anchor" aria-label="anchor" href="#causal-mediation-models"><i class="fas fa-link"></i></a>
</h2>
<p>In this workshop we will use directed acyclic graphs. We will focus on the two
types of graph:</p>
<div id="no-intermediate-confounders" class="section level3">
<h3>
<span class="header-section-number">1.3.1</span> No intermediate confounders<a class="anchor" aria-label="anchor" href="#no-intermediate-confounders"><i class="fas fa-link"></i></a>
</h3>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-4"></span>
<img src="01-preface_files/figure-html/unnamed-chunk-4-1.png" alt="Directed acyclic graph under *no intermediate confounders* of the mediator-outcome relation affected by treatment" width="80%"><p class="caption">
FIGURE 1.1: Directed acyclic graph under <em>no intermediate confounders</em> of the mediator-outcome relation affected by treatment
</p>
</div>
</div>
<div id="intermediate-confounders" class="section level3">
<h3>
<span class="header-section-number">1.3.2</span> Intermediate confounders<a class="anchor" aria-label="anchor" href="#intermediate-confounders"><i class="fas fa-link"></i></a>
</h3>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-5"></span>
<img src="01-preface_files/figure-html/unnamed-chunk-5-1.png" alt="Directed acyclic graph under intermediate confounders of the mediator-outcome relation affected by treatment" width="80%"><p class="caption">
FIGURE 1.2: Directed acyclic graph under intermediate confounders of the mediator-outcome relation affected by treatment
</p>
</div>
<p>The above graphs can be interpreted as a <em>non-parametric structural equation model</em>
(NPSEM), also known as <em>structural causal model</em> (SCM):</p>
<p><span class="math display">\[\begin{align}
  W &amp; = f_W(U_W)\\
  A &amp; = f_A(W, U_A)\\
  Z &amp; = f_Z(W, A, U_Z)\\
  M &amp; = f_M(W, A, Z, U_M)\\
  Y &amp; = f_Y(W, A, Z, M, U_Y)
\end{align}\]</span></p>
<ul>
<li>Here <span class="math inline">\(U=(U_W, U_A, U_Z, U_M, U_Y)\)</span> is a vector of all unmeasured exogenous
factors affecting the system</li>
<li>The functions <span class="math inline">\(f\)</span> are assumed fixed but unknown</li>
<li>We posit this model as a system of equations that nature uses to geenrate the
data</li>
<li>Therefore we leave the functions <span class="math inline">\(f\)</span> unspecified (i.e., we do not know the
true nature mechanisms)</li>
<li>Sometimes we know something: e.g., if <span class="math inline">\(A\)</span> is randomized we know <span class="math inline">\(A=f_A(U_A)\)</span>
where <span class="math inline">\(U_A\)</span> is the flip of a coin (i.e., independent of everything).</li>
</ul>
</div>
</div>
<div id="counterfactuals" class="section level2">
<h2>
<span class="header-section-number">1.4</span> Counterfactuals<a class="anchor" aria-label="anchor" href="#counterfactuals"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>We define all the effects of interest using <em>counterfactuals</em>
</li>
<li>Counterfactuals are hypothetical random variables that would have been
observed in an alternative world where something had happened, possibly
contrary to fact <!--we would be able to perform interventions on the
  random variables of interest-->
</li>
<li>
<span class="math inline">\(Y_a\)</span> is a counterfactual variable in a hypothetical world where <span class="math inline">\(\P(A=a)=1\)</span>
with probability one</li>
<li>
<span class="math inline">\(Y_{a,m}\)</span> is the counterfactual outcome in a world where <span class="math inline">\(\P(A=a,M=m)=1\)</span>
</li>
<li>
<span class="math inline">\(M_a\)</span> is the counterfactual variable representing the mediator in a world
where <span class="math inline">\(\P(A=a)=1\)</span>.</li>
</ul>
<div id="how-are-counterfactuals-defined" class="section level3">
<h3>
<span class="header-section-number">1.4.1</span> How are counterfactuals defined?<a class="anchor" aria-label="anchor" href="#how-are-counterfactuals-defined"><i class="fas fa-link"></i></a>
</h3>
<!-- - You can use counterfactual variables as _primitives_ -->
<ul>
<li>In the NPSEM framework, counterfactuals are quantities <em>derived</em> from the
model.</li>
<li>Take as example the DAG in Figure 1.2:
<span class="math display">\[\begin{align}
  Y_a  &amp;= f_Y(W, a, Z_a, M_a, U_Y)\\
  Y_{a,m}  &amp;= f_Y(W, a, Z_a, m, U_Y)\\
  M_a  &amp;= f_M(W, a, Z_a, U_M)
\end{align}\]</span>
</li>
<li>You can also define <em>nested counterfactuals</em>
</li>
<li>For example, if <span class="math inline">\(A\)</span> is binary, you can think of the following counterfactual
<span class="math display">\[\begin{equation*}
  Y_{1, M_0} = f_Y(W, 1, Z_1, M_0, U_Y)
\end{equation*}\]</span>
</li>
<li>Interpreted as <em>the outcome for an individual in a hypothetical world where
treatment was given but the mediator was held at the value it would have
taken under no treatment</em>
</li>
<li>Causal effects are defined in terms of the distribution of these
counterfactuals.</li>
<li>That is, causal effects give you information about what would have happened
<em>in some hypothetical world</em>.</li>
</ul>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="index.html">Welcome to SER!</a></div>
<div class="next"><a href="estimands.html"><span class="header-section-number">2</span> Types of path-specific causal mediation effects</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#mediation"><span class="header-section-number">1</span> Causal mediation analysis intro</a></li>
<li><a class="nav-link" href="#motivating-study"><span class="header-section-number">1.1</span> Motivating study</a></li>
<li>
<a class="nav-link" href="#what-is-causal-mediation-analysis"><span class="header-section-number">1.2</span> What is causal mediation analysis?</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#why-are-the-methods-that-we-will-discuss-today-important"><span class="header-section-number">1.2.1</span> Why are the methods that we will discuss today important?</a></li>
<li><a class="nav-link" href="#r-example"><span class="header-section-number">1.2.2</span> R Example:</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#causal-mediation-models"><span class="header-section-number">1.3</span> Causal mediation models</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#no-intermediate-confounders"><span class="header-section-number">1.3.1</span> No intermediate confounders</a></li>
<li><a class="nav-link" href="#intermediate-confounders"><span class="header-section-number">1.3.2</span> Intermediate confounders</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#counterfactuals"><span class="header-section-number">1.4</span> Counterfactuals</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#how-are-counterfactuals-defined"><span class="header-section-number">1.4.1</span> How are counterfactuals defined?</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/nhejazi/ser2021_mediation_workshop/blob/master/01-preface.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/nhejazi/ser2021_mediation_workshop/edit/master/01-preface.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>[SER 2021 Workshop] Causal Mediation: Modern Methods for Path Analysis</strong>" was written by Iván Díaz, Nima Hejazi, Kara Rudolph. It was last built on updated: May 17, 2021.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
