<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Estimating natural and interventional effects | [SER 2021 Workshop] Causal Mediation: Modern Methods for Path Analysis</title>
<meta name="author" content="Iván Díaz, Nima Hejazi, Kara Rudolph">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4.9003/tabs.js"></script><script src="libs/bs3compat-0.2.4.9003/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
</head>
<body>
<span class="math inline">
  \(\DeclareMathOperator{\expit}{expit}\)
  \(\DeclareMathOperator{\logit}{logit}\)
  \(\DeclareMathOperator*{\argmin}{\arg\!\min}\)
  \(\newcommand{\indep}{\perp\!\!\!\perp}\)
  \(\newcommand{\coloneqq}{\mathrel{=}}\)
  \(\newcommand{\R}{\mathbb{R}}\)
  \(\newcommand{\E}{\mathbb{E}}\)
  \(\newcommand{\M}{\mathcal{M}}\)
  \(\renewcommand{\P}{\mathbb{P}}\)
  \(\newcommand{\I}{\mathbb{I}}\)
  \(\newcommand{\1}{\mathbbm{1}}\)
  </span>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">[SER 2021 Workshop] Causal Mediation: Modern Methods for Path Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome to SER!</a></li>
<li><a class="" href="mediation.html"><span class="header-section-number">1</span> Preliminaries on causal mediation analysis</a></li>
<li><a class="" href="estimands.html"><span class="header-section-number">2</span> Path-specific casual mediation effect types</a></li>
<li><a class="" href="estimandirl.html"><span class="header-section-number">3</span> How to choose an estimand: Real world example</a></li>
<li><a class="" href="stochastic.html"><span class="header-section-number">4</span> Stochastic Direct and Indirect Effects</a></li>
<li><a class="" href="preliminaries-on-semiparametric-estimation.html"><span class="header-section-number">5</span> Preliminaries on semiparametric estimation</a></li>
<li><a class="active" href="estimating-natural-and-interventional-effects.html"><span class="header-section-number">6</span> Estimating natural and interventional effects</a></li>
<li><a class="" href="estimating-stochastic-effects.html"><span class="header-section-number">7</span> Estimating stochastic effects</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/nhejazi/ser2021_mediation_workshop">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="estimating-natural-and-interventional-effects" class="section level1">
<h1>
<span class="header-section-number">6</span> Estimating natural and interventional effects<a class="anchor" aria-label="anchor" href="#estimating-natural-and-interventional-effects"><i class="fas fa-link"></i></a>
</h1>
<div id="natural-indirect-effects" class="section level2">
<h2>
<span class="header-section-number">6.1</span> Natural (in)direct effects<a class="anchor" aria-label="anchor" href="#natural-indirect-effects"><i class="fas fa-link"></i></a>
</h2>
<p>Recall:</p>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-1"></span>
<img src="06-estimation-natural-interventional_files/figure-html/unnamed-chunk-1-1.png" alt="Directed acyclic graph under *no intermediate confounders* of the mediator-outcome relation affected by treatment" width="80%"><p class="caption">
FIGURE 2.1: Directed acyclic graph under <em>no intermediate confounders</em> of the mediator-outcome relation affected by treatment
</p>
</div>
<p>Assuming a binary <span class="math inline">\(A\)</span>, we define the natural direct effect as:
<span class="math display">\[NDE = E(Y_{1,M_{0}} - Y_{0,M_{0}})\]</span>,</p>
<p>and the natural indirect effect as:
<span class="math display">\[NIE = E(Y_{1,M_{1}} - Y_{1,M_{0}})\]</span>.</p>
<div id="simple-case-for-intuition" class="section level3">
<h3>
<span class="header-section-number">6.1.1</span> Simple case for intuition<a class="anchor" aria-label="anchor" href="#simple-case-for-intuition"><i class="fas fa-link"></i></a>
</h3>
<p>The observed data is <span class="math inline">\(O=(W, A, M, Y)\)</span></p>
<p>This SCM is represented in the above DAG and the following causal models:
<span class="math display">\[\begin{align*}
  W &amp; = f_W(U_W)\\
  A &amp; = f_A(W, U_A)\\
  M &amp; = f_M(W, A, U_M)\\
  Y &amp; = f_Y(W, A, M, U_Y),
\end{align*}\]</span>
where <span class="math inline">\((U_W, U_A,U_M, U_Y)\)</span> are exogenous random errors.</p>
<p>We assume
- <span class="math inline">\(A\)</span> is a single binary randomized treatment (and thus <span class="math inline">\(A = f_A(U_A)\)</span>)
- <span class="math inline">\(M\)</span> is a single binary mediator
- There are no restrictions on the distribution of <span class="math inline">\(W\)</span> or <span class="math inline">\(Y\)</span></p>
<p>Recall that we need to assume the following to identify the above caual effects
from our observed data:</p>
<ul>
<li><span class="math inline">\(A \indep Y_{a,m} \mid W\)</span></li>
<li><span class="math inline">\(M \indep Y_{a,m} \mid W, A\)</span></li>
<li><span class="math inline">\(A \indep M_a \mid W\)</span></li>
<li><span class="math inline">\(M_0 \indep Y_{1,m} \mid W\)</span></li>
<li>and positivity assumptions</li>
</ul>
</div>
<div id="how-to-estimate-using-g-computation" class="section level3">
<h3>
<span class="header-section-number">6.1.2</span> How to estimate using G-computation<a class="anchor" aria-label="anchor" href="#how-to-estimate-using-g-computation"><i class="fas fa-link"></i></a>
</h3>
<!--
ID: Should we add the g-computation formula here?
-->
<p>Let’s take the NDE as an example:</p>
<ol style="list-style-type: decimal">
<li>Fit a regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(M,A,W\)</span>. Predict outcome values setting <span class="math inline">\(A=1\)</span>.
We’ll call the result <span class="math inline">\(\bar{Q}_Y(M,1,W)\)</span>. Predict outcome values setting
<span class="math inline">\(A=0\)</span>. We’ll call the result <span class="math inline">\(\bar{Q}_Y(M,0,W)\)</span>.</li>
<li>Take the difference <span class="math inline">\(\bar{Q}_Y(M,1,W) - \bar{Q}_Y(M,0,W)\)</span> and regress it on
<span class="math inline">\(W\)</span> among those for whom <span class="math inline">\(A=0\)</span>. This recovers the expected difference had all
individuals been set to the control condition <span class="math inline">\(A = 0\)</span>.</li>
<li>The sample mean of the predicted values gives the estimate.</li>
</ol>
</div>
<div id="how-to-estimate-using-the-doubly-robust-methods-that-rely-on-the-eif" class="section level3">
<h3>
<span class="header-section-number">6.1.3</span> How to estimate using the doubly robust methods that rely on the EIF<a class="anchor" aria-label="anchor" href="#how-to-estimate-using-the-doubly-robust-methods-that-rely-on-the-eif"><i class="fas fa-link"></i></a>
</h3>
<p>The EIC for the NDE (<span class="math inline">\(\Psi_{NDE}\)</span>) is given by:</p>
<!--
ID: I'd suggest using the notation in our biometrika paper for the below
-->
<p><span class="math display">\[\begin{align}
    D^{\star} &amp;= \bigg\{ \frac{I(A=1)}{g(1|W)}\frac{Q(M|W,0)}{Q(M|W,1)} -
      \frac{I(A=0)}{g(0|W)}\bigg\} \times (Y-\bar{Q}_Y(M,A,W))  \\
    &amp;+ \frac{I(A=0)}{g(0|W)}\{ \bar{Q}_{diff} - E(\bar{Q}_{diff} | W,0) \}\\
    &amp;+ E(\bar{Q}_{diff} | W,0) - \Psi_{NDE}
\end{align}\]</span></p>
</div>
<div id="how-to-estimate-using-the-one-step-estimator-essentially-a-iptw" class="section level3">
<h3>
<span class="header-section-number">6.1.4</span> How to estimate using the one-step estimator (essentially A-IPTW)<a class="anchor" aria-label="anchor" href="#how-to-estimate-using-the-one-step-estimator-essentially-a-iptw"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>Estimate
<span class="math display">\[\begin{equation*}
 C_Y(Q_M, g)(O) = \Bigg\{\frac{\I(A = 1)}{g(1 \mid W)}
   \frac{Q_M(M \mid 0, W)}{Q_M(M \mid 1, W)} -
   \frac{\I(A = 0)}{g(0 \mid W)} \Bigg\}.
  \end{equation*}\]</span>
Breaking this down, <span class="math inline">\(\frac{\I(A = 1)}{g(1 \mid W)}\)</span> is the inverse probability
weight for <span class="math inline">\(A = 1\)</span> and, likewise, <span class="math inline">\(\frac{\I(A = 0)}{g(0 \mid W)}\)</span> is the inverse
probability weight for <span class="math inline">\(A = 0\)</span>. The middle term is the ratio of the mediator
density when <span class="math inline">\(A = 0\)</span> to the mediator density when <span class="math inline">\(A = 1\)</span>.</li>
</ol>
<p>Estimating <span class="math inline">\(Q_M\)</span> is a really hard problem when <span class="math inline">\(M\)</span> is high-dimensional. But,
since we have the ratio of these conditional densitities, we can reparamterize
using Bayes rule to get something that is easier to compute:
<span class="math display">\[\begin{equation*}
  \frac{\P(A = 0 \mid M, W) g(0 \mid W)}{\P(A = 1 \mid M, W) g(1 \mid W)}.
\end{equation*}\]</span></p>
<!--Underneath the hood, the counterfactual outcome difference,
$\bar{Q}_{\text{diff}}$, and $P(A \mid Z, W)$, the conditional probability of $A$
given $Z$ and $W$, are used in constructing the auxiliary covariate for TML
estimation. These nuisance parameters play an important role in the
bias-correcting _TMLE-update step_.-->
<ol style="list-style-type: decimal">
<li>We estimate <span class="math inline">\(g_{A \mid W}(W)=P(A=a \mid W)\)</span> from a logistic regression of
<span class="math inline">\(A\)</span> on <span class="math inline">\(W\)</span>, generating predicted probabilities that <span class="math inline">\(A=1\)</span> for <span class="math inline">\(g(1 \mid W)\)</span>
and <span class="math inline">\(A=0\)</span> for <span class="math inline">\(g(0 \mid W)\)</span>.<br>
</li>
<li>We estimate <span class="math inline">\(\P(A=a \mid M, W)\)</span> from a logistic regression of <span class="math inline">\(A\)</span> on <span class="math inline">\(M, W\)</span>,
generating predicted probabilities that <span class="math inline">\(A=1\)</span> for and <span class="math inline">\(A=0\)</span>.</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">amodel</span> <span class="op">&lt;-</span> <span class="st">"a ~ w "</span>
<span class="va">mmodel</span> <span class="op">&lt;-</span> <span class="st">"m ~ a + w"</span>
<span class="va">amodel</span> <span class="op">&lt;-</span> <span class="st">"a ~ m + w"</span>
<span class="va">ymodel</span> <span class="op">&lt;-</span> <span class="st">"y ~ m + a*w"</span>

<span class="co"># make gm</span>
<span class="va">afit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">amodel</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">obsdat</span><span class="op">)</span>
<span class="va">mfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">mmodel</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">obsdat</span><span class="op">)</span>

<span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">afit</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>w <span class="op">=</span> <span class="va">obsdat</span><span class="op">$</span><span class="va">w</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="va">a0</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">a1</span>

<span class="va">am1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">amfit</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>w <span class="op">=</span> <span class="va">obsdat</span><span class="op">$</span><span class="va">w</span>, m <span class="op">=</span> <span class="va">obsdat</span><span class="op">$</span><span class="va">m</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span>
<span class="op">)</span>
<span class="va">am0</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">am1</span>
<span class="va">cy</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">am0</span> <span class="op">*</span> <span class="va">a0</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">am1</span> <span class="op">*</span> <span class="va">a1</span><span class="op">)</span></code></pre></div>
<p><span class="math inline">\(\bar{Q}_Y(M,a^\prime,W) - \bar{Q}_Y(M,a^\star,W)\)</span></p>
<ol start="3" style="list-style-type: decimal">
<li>To obtain an estimate of <span class="math inline">\(\bar{Q}_{diff} = \bar{Q}_Y(M,1,W) - \bar{Q}_Y(M,0,W)\)</span>, predict values of <span class="math inline">\(Y\)</span> from a regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(M,A,W\)</span>,
setting <span class="math inline">\(A=1\)</span> and <span class="math inline">\(A=0\)</span>, giving <span class="math inline">\(\hat{Y}(m, 1, w)\)</span> and <span class="math inline">\(\hat{Y}(m, 1, w)\)</span>.</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">qyinit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>
    formula <span class="op">=</span> <span class="va">ymodel</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,
    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, a <span class="op">=</span> <span class="va">a</span>, m <span class="op">=</span> <span class="va">m</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, <span class="va">a</span>, <span class="va">m</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"response"</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>
    formula <span class="op">=</span> <span class="va">ymodel</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,
    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, a <span class="op">=</span> <span class="va">a</span>, m <span class="op">=</span> <span class="va">m</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, a <span class="op">=</span> <span class="fl">0</span>, <span class="va">m</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"response"</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>
    formula <span class="op">=</span> <span class="va">ymodel</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,
    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, z <span class="op">=</span> <span class="va">z</span>, m <span class="op">=</span> <span class="va">m</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, a <span class="op">=</span> <span class="fl">1</span>, <span class="va">m</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"response"</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">qbardiff</span> <span class="op">&lt;-</span> <span class="va">qyinit</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">qyinit</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>We then regress <span class="math inline">\(\hat{\bar{Q}}_{diff}(M,A,W)\)</span> on <span class="math inline">\(W\)</span> among those
with <span class="math inline">\(A=0\)</span> and take the mean.</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">margqdiff_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">qbardiff</span> <span class="op">~</span> <span class="va">w</span>,
  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    qbardiff <span class="op">=</span> <span class="va">qbardiff</span><span class="op">[</span><span class="va">a</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>,
    w <span class="op">=</span> <span class="va">w</span><span class="op">[</span><span class="va">a</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="va">margqdiff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">margqdiff_fit</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>qbardiff <span class="op">=</span> <span class="va">qbardiffup</span>, w <span class="op">=</span> <span class="va">w</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">meanmargqdiff</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">margqdiff</span><span class="op">)</span></code></pre></div>
<!--4. Estimate $\hat{\epsilon}$ by setting $\epsilon$ as the intercept of a
   weighted logistic regression model of $Y$ with
   $logit(\hat{\bar{Q}}_{Y}(M,A,W))$ as an offset and weights $\hat{C}_{Y}$.-->
<ol start="6" style="list-style-type: decimal">
<li>Plug in the estimates of these nuisance parameters to the EIC, set it equal to 0, and solve. This gives an estimate of the NDE.</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">os_nde</span> <span class="op">&lt;-</span> <span class="va">cy</span><span class="op">*</span><span class="op">(</span><span class="va">y</span><span class="op">-</span><span class="va">qyinit</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">a0</span><span class="op">/</span><span class="va">am0</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">qbardiff</span> <span class="op">-</span> <span class="va">meanmargqdiff</span><span class="op">)</span> <span class="op">+</span> <span class="va">meanmargqdiff</span></code></pre></div>
<!--6. The estimates of $\bar{Q}_{Y}(M,1,W)$ and $\bar{Q}_{Y}(M,0,W)$ are updated
   by $\hat{\bar{Q}}^{\star}_{Y}(M,A,W) =
   \hat{\bar{Q}}_{Y}(\epsilon_n)(M,A,W)$. This gives an updated difference:
   $\hat{\bar{Q}}^{\star}_{diff}(M,A,W)$.


```r
epsilon <- coef(glm(y ~ 1,
  weights = cy, offset = (qlogis(qyinit[, 1])),
  family = "quasibinomial"
))
qyupa0 <- plogis(qlogis(qyinit[, 2]) + epsilon)
qyupa1 <- plogis(qlogis(qyinit[, 3]) + epsilon)
qdiffup <- qyupa1 - qyupa0
```
-->
</div>
</div>
<div id="interventional-direct-and-indirect-effects" class="section level2">
<h2>
<span class="header-section-number">6.2</span> Interventional direct and indirect effects<a class="anchor" aria-label="anchor" href="#interventional-direct-and-indirect-effects"><i class="fas fa-link"></i></a>
</h2>
<p>Recall that in the presence of a intermediate confounder natural (in)direct effects are not identified</p>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-7"></span>
<img src="06-estimation-natural-interventional_files/figure-html/unnamed-chunk-7-1.png" alt="Directed acyclic graph under intermediate confounders of the mediator-outcome relation affected by treatment" width="80%"><p class="caption">
FIGURE 6.1: Directed acyclic graph under intermediate confounders of the mediator-outcome relation affected by treatment
</p>
</div>
<!--
ID: I suggest using the Y_{a, G_a'} notation I used in the other page to define these effects
-->
<p>We define the interventional direct effect as:
<span class="math display">\[\begin{equation*}
  \psi_{\text{PIDE}} = \E(Y_{a^\prime,g_{M \mid a^\star,W}} -
    Y_{a\star,g_{M \mid a^\star,W}}),
\end{equation*}\]</span></p>
<p>and the interventional indirect effect as:</p>
<p><span class="math display">\[\begin{equation*}
  \psi_{\text{PIIE}} = \E(Y_{a^\prime,g_{M \mid a^\prime,W}} -
    Y_{a^\prime,g_{M \mid a^\star,W}}).
\end{equation*}\]</span></p>
</div>
<div id="simple-case-for-intuition-1" class="section level2">
<h2>
<span class="header-section-number">6.3</span> Simple case for intuition<a class="anchor" aria-label="anchor" href="#simple-case-for-intuition-1"><i class="fas fa-link"></i></a>
</h2>
<p>Consider a simple data structure <span class="math inline">\(O=(W, A, Z, M, Y)\)</span>. This SCM is represented in
the above DAG and the following causal models:
<span class="math display">\[\begin{align*}
W &amp; = f_W(U_W)\\
A &amp; = f_A(W, U_A)\\
Z &amp; = f_Z(W, A, U_Z)\\
M &amp; = f_M(W, A, Z, U_M)\\
Y &amp; = f_Y(W, A, Z, M, U_Y),
\end{align*}\]</span>
where (<span class="math inline">\(U_W, U_A, U_Z, U_M, U_Y\)</span>) are exogenous random errors. We assume <span class="math inline">\(A\)</span> is
a single binary treatment, <span class="math inline">\(Z\)</span> is a single binary intermediate confounder, <span class="math inline">\(M\)</span>
is a single binary mediator. There are no restrictions on the distribution of
<span class="math inline">\(W\)</span> or <span class="math inline">\(Y\)</span>.</p>
<p><span class="math inline">\(g_{M \mid a^\prime,W}\)</span> represents the counterfactual,
conditional distribution of <span class="math inline">\(M\)</span>, as described by
<span class="citation">VanderWeele (<a href="references.html#ref-vanderweele2016mediation" role="doc-biblioref">2016</a>)</span>:</p>
<!--
ID: The below is not a stochastic draw, it is the distribution that you are
drawing from. Also, not sure about that last equality, isn't that just part of
the identification strategy, of which we have not talked about? Probably
confusing to put that in here.
-->
<p><span class="math display">\[\begin{equation*}
  g_{M \mid A,W}(m, a^{\star}, W) \equiv g_{M \mid a^{\star}, W}(W) =
    \sum_{z=0}^1 \P(M=1 \mid Z=z,W) \P(Z=z \mid A=a^{\star}, W).
\end{equation*}\]</span></p>
<!--
ID: Why would we make the below assumption if we have estimators that do not
require it? It will probably just confuse people to say that we make this
assumption and then have software that does not make that assumption
-->
<p>In what follows, we are going to assume that <span class="math inline">\(g_{M \mid A,W}(m, a^{\star}, W)\)</span>
is known, estimated from observed data, which we call
<span class="math inline">\(\hat{g}_{M \mid a^{\star}, W}\)</span>. This is going to slightly alter the usual
identification assumptions such that we no longer need to assume exchangeability
of <span class="math inline">\(A\)</span> and the counterfactual <span class="math inline">\(M\)</span> values. This means the remaining assumptions
are the same as those for controlled direct effects.</p>
<div id="estimation-using-g-computation" class="section level3">
<h3>
<span class="header-section-number">6.3.1</span> Estimation using G-Computation<a class="anchor" aria-label="anchor" href="#estimation-using-g-computation"><i class="fas fa-link"></i></a>
</h3>
<p>The estimand <span class="math inline">\(E(Y_{a^\prime, \hat{g}_{M \mid a^\star,W}})\)</span> can be identified
via sequential regression, which provides the framework for the
G-computation-based estimator. The procedure is as follows</p>
<ol style="list-style-type: decimal">
<li>Fit a regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(M,Z,W\)</span>. Predict outcome values under under
<span class="math inline">\(M=m\)</span>. We’ll call the result <span class="math inline">\(\bar{Q}_Y(M,Z,W)\)</span>.</li>
<li>Integrate out <span class="math inline">\(M\)</span> under our stochastic intervention
<span class="math inline">\(\hat{g}_{M \mid a^{\star}, W}\)</span>. We can do this by evaluating
<span class="math inline">\(\E(Y \mid M=m,Z=z,W)\)</span> at each <span class="math inline">\(m\)</span> and multiplying it by the probability
that <span class="math inline">\(M=m\)</span> under <span class="math inline">\(\hat{g}_{M \mid a^{\star}, W}\)</span>, summing over all <span class="math inline">\(m\)</span>.
We’ll call the results <span class="math inline">\(\bar{Q}^{g}_M(Z,W)\)</span>.</li>
<li>Integrate out <span class="math inline">\(Z\)</span> and set <span class="math inline">\(A=a^\prime\)</span>. Again, we can do this by evaluating
the predicted values from Step 2, setting <span class="math inline">\(A=a^\prime\)</span>, and at each <span class="math inline">\(z\)</span>,
multiplying the prediction by the probability that <span class="math inline">\(Z=z\)</span> under <span class="math inline">\(A=a^\prime\)</span>.
We’ll call the result <span class="math inline">\(\bar{Q}^{a^\prime}_Z(W)\)</span>.</li>
<li>Taking the sample mean (marginalizing over <span class="math inline">\(W\)</span>) gives the parameter
estimate.</li>
</ol>
</div>
<div id="estimate-with-doubly-robust-methods-based-on-the-eif" class="section level3">
<h3>
<span class="header-section-number">6.3.2</span> Estimate with doubly robust methods based on the EIF<a class="anchor" aria-label="anchor" href="#estimate-with-doubly-robust-methods-based-on-the-eif"><i class="fas fa-link"></i></a>
</h3>
<p>We are showing the one-step estimator (generalization of A-IPW)</p>
<p>The EIF for the parameter <span class="math inline">\(\Psi(P)(a^{\prime}, \hat{g}_{M \mid a^{\star},W})\)</span>,
where, again, <span class="math inline">\(\hat{g}_{M \mid a^{\star}, W}\)</span> is assumed known, is given by:
<span class="math display">\[\begin{align*}
  D^{\star}(a^{\prime}, \hat{g}_{M \mid a^{\star}, W}) &amp;= \sum_{k=0}^2
      D_k^{\star}(a^{\prime}, \hat{g}_{M \mid a^{\star}, W}), \text{ where }\\
  D^{\star}_0(a^{\prime}, \hat{g}_{M \mid a^{\star}, W}) &amp;=
      \bar{Q}^{a^{\prime}}_{Z(W)} -
      \Psi(P)(a^{\prime}, \hat{g}_{M \mid a^{\star}, W})\\
  D^{\star}_1(a^{\prime}, \hat{g}_{M \mid a^{\star}, W}) &amp;=
      \frac{I(A=a^{\prime})}{\P(A=a^{\prime} \mid W)}(\bar{Q}^{\hat{g}}_M(Z,W)
      - \bar{Q}^{a^{\prime}}_{Z(W)})\\
  D^{\star}_2(a^{\prime}, \hat{g}_{M \mid a^{\star}, W}) &amp;=
      \frac{I(A=a^{\prime})\{I(M=1) \hat{g}_{M \mid a^{\star}, W} +
      I(M=0)(1-\hat{g}_{M \mid a^{\star}, W}) \}}{\P(A=a^{\prime}}
      &amp;\times (Y-\bar{Q}_{Y(M,Z,W)}).
\end{align*}\]</span></p>
<!---### Estimate using TMLE-->
<ol style="list-style-type: decimal">
<li>We estimate <span class="math inline">\(g_{Z \mid a^{\star}, W}(W) = \P(Z=1 \mid A=a^{\star}, W)\)</span> from
a logistic regression of <span class="math inline">\(Z\)</span> on <span class="math inline">\(A, W\)</span> setting <span class="math inline">\(A=a^{\star}\)</span>.</li>
<li>We then estimate <span class="math inline">\(g_{M \mid z,W}(W) = \P(M=1 \mid Z=z, W)\)</span> from a logistic
regression of <span class="math inline">\(M\)</span> on <span class="math inline">\(Z, W\)</span>, setting <span class="math inline">\(z=\{0,1\}\)</span>.</li>
<li>We use these quantities to calculate <span class="math inline">\(\hat{g}_{M \mid a^{\star}, W} = \hat{g}_{M \mid z=1,W}\hat{g}_{Z \mid a^{\star}, W} + \hat{g}_{M \mid z=0,W}(1-\hat{g}_{Z|a^{\star}, W})\)</span>.</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">zmodel</span> <span class="op">&lt;-</span> <span class="st">"z ~ a + w1 "</span>
<span class="va">mmodel</span> <span class="op">&lt;-</span> <span class="st">"m ~ z + w1"</span>
<span class="va">ymodel</span> <span class="op">&lt;-</span> <span class="st">"y ~ m + z*w1"</span>

<span class="co"># make gm and get counterfactual predictions</span>
<span class="va">zfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">zmodel</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">obsdat</span><span class="op">)</span>
<span class="va">mfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">mmodel</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">obsdat</span><span class="op">)</span>

<span class="va">za0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">zfit</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>w1 <span class="op">=</span> <span class="va">obsdat</span><span class="op">$</span><span class="va">w1</span>, a <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span>
<span class="op">)</span>
<span class="va">za1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">zfit</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>w1 <span class="op">=</span> <span class="va">obsdat</span><span class="op">$</span><span class="va">w1</span>, a <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span>
<span class="op">)</span>

<span class="va">mz1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mfit</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>w1 <span class="op">=</span> <span class="va">obsdat</span><span class="op">$</span><span class="va">w1</span>, z <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span>
<span class="op">)</span>
<span class="va">mz0</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mfit</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>w1 <span class="op">=</span> <span class="va">obsdat</span><span class="op">$</span><span class="va">w1</span>, z <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"response"</span>
<span class="op">)</span>

<span class="va">gm0</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">mz1</span> <span class="op">*</span> <span class="va">za0</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">mz0</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">za0</span><span class="op">)</span><span class="op">)</span>
<span class="va">gma1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">mz1</span> <span class="op">*</span> <span class="va">za1</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">mz0</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">za1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>To obtain an estimate of <span class="math inline">\(\bar{Q}_{Y}(M,Z,W)\)</span>, predict values of <span class="math inline">\(Y\)</span> from a
regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(M,Z,W\)</span>, setting <span class="math inline">\(m=1\)</span> and <span class="math inline">\(m=0\)</span>, giving
<span class="math inline">\(\hat{Y}(m=1, z, w)\)</span> and <span class="math inline">\(\hat{Y}(m=0, z, w)\)</span>.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmpdat</span><span class="op">$</span><span class="va">qyinit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>
    formula <span class="op">=</span> <span class="va">ymodel</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,
    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, z <span class="op">=</span> <span class="va">z</span>, m <span class="op">=</span> <span class="va">m</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, z <span class="op">=</span> <span class="va">z</span>, m <span class="op">=</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"response"</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>
    formula <span class="op">=</span> <span class="va">ymodel</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,
    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, z <span class="op">=</span> <span class="va">z</span>, m <span class="op">=</span> <span class="va">m</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, z <span class="op">=</span> <span class="va">z</span>, m <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"response"</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>
    formula <span class="op">=</span> <span class="va">ymodel</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,
    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, z <span class="op">=</span> <span class="va">z</span>, m <span class="op">=</span> <span class="va">m</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, z <span class="op">=</span> <span class="va">z</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"response"</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Estimate the weights <!--to be used for the initial targeting step-->:
<span class="math display">\[\begin{equation*}
   h_1(a) = \frac{I(A=a)\{I(M=1)\hat{g}_{M \mid a^{\star}, W} +
     I(M=0)(1-\hat{g}_{M \mid a^{\star}, W}) \}}{\P(A=a)\{I(M=1)
     g_{M \mid Z,W} + I(M=0)(1-g_{M \mid Z,W}) \}}
\end{equation*}\]</span>
</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">psa1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">a</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span>
<span class="va">psa0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">a</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">a</span><span class="op">)</span>
<span class="va">mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>
  formula <span class="op">=</span> <span class="va">mmodel</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,
  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, z <span class="op">=</span> <span class="va">z</span>, m <span class="op">=</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>,
newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">datw</span>, z <span class="op">=</span> <span class="va">z</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"response"</span>
<span class="op">)</span>
<span class="va">psm</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">mz</span> <span class="op">*</span> <span class="va">m</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">mz</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span>

<span class="va">tmpdat</span><span class="op">$</span><span class="va">ha1gma1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">m</span> <span class="op">*</span> <span class="va">gma1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">m</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">gma1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">psm</span><span class="op">)</span> <span class="op">*</span> <span class="va">psa1</span> 
<span class="va">tmpdat</span><span class="op">$</span><span class="va">ha1gma0</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">m</span> <span class="op">*</span> <span class="va">gm</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">m</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">gm</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">psm</span><span class="op">)</span> <span class="op">*</span> <span class="va">psa1</span> 
<span class="va">tmpdat</span><span class="op">$</span><span class="va">ha0gma0</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">m</span> <span class="op">*</span> <span class="va">gm</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">m</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">gm</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">psm</span><span class="op">)</span> <span class="op">*</span> <span class="va">psa0</span> </code></pre></div>
<!--
6. Estimate $\hat{\epsilon}$ by setting $\epsilon$ as the intercept of a
   weighted logistic regression model of $Y$ with
   $\text{logit}(\hat{\bar{Q}}_{Y}(M,Z,W))$ as an offset and weights
   $\hat{h}_{1}(a)$. (Note that this is just one possible TMLE.)
<!--
7. The estimate of $\bar{Q}_{Y}(M,Z,W)$ is updated by
   $\hat{\bar{Q}}^{\star}_{Y}(M,Z,W) =  \hat{\bar{Q}}_{Y}(\epsilon_n)(M,Z,W)$.


```r
# for E(Y_{1,gmastar})
epsilonma1g0 <- coef(glm(y ~ 1,
  weights = tmpdat$ha1gma0,
  offset = (qlogis(qyinit[, 1])),
  family = "quasibinomial", data = tmpdat
))
tmpdat$qyupm0a1g0 <- plogis(qlogis(tmpdat$qyinit[, 2]) + epsilonma1g0)
tmpdat$qyupm1a1g0 <- plogis(qlogis(tmpdat$qyinit[, 3]) + epsilonma1g0)

# for E(Y_{1,gma})
epsilonma1g1 <- coef(glm(y ~ 1,
  weights = tmpdat$ha1gma1,
  offset = (qlogis(qyinit[, 1])),
  family = "quasibinomial", data = tmpdat
))
tmpdat$qyupm0a1g1 <- plogis(qlogis(tmpdat$qyinit[, 2]) + epsilonma1g1)
tmpdat$qyupm1a1g1 <- plogis(qlogis(tmpdat$qyinit[, 3]) + epsilonma1g1)

# for E(Y_{0,gmastar})
epsilonma0g0 <- coef(glm(y ~ 1,
  weights = tmpdat$ha0gma0,
  offset = (qlogis(qyinit[, 1])),
  family = "quasibinomial", data = tmpdat
))
tmpdat$qyupm0a0g0 <- plogis(qlogis(tmpdat$qyinit[, 2]) + epsilonma0g0)
tmpdat$qyupm1a0g0 <- plogis(qlogis(tmpdat$qyinit[, 3]) + epsilonma0g0)
```
-->
<ol start="6" style="list-style-type: decimal">
<li>We next integrate out <span class="math inline">\(M\)</span> from <span class="math inline">\(\bar{Q}_{Y}(M,Z,W)\)</span>. First, we
estimate <span class="math inline">\(\bar{Q}_{Y,n}(M,Z,W)\)</span> setting <span class="math inline">\(m=1\)</span> and <span class="math inline">\(m=0\)</span>, giving
<span class="math inline">\(\bar{Q}_Y(m=1, z, w)\)</span> and <span class="math inline">\(\bar{Q}_Y(m=0, z, w)\)</span>. Then,
multiply these predicted values by their probabilities under
<span class="math inline">\(\hat{g}_{M \mid a^{\star},W}(W)\)</span> (for <span class="math inline">\(a \in \{a, a^{\star}\}\)</span>), and add
them together (i.e., <span class="math inline">\(\bar{Q}^{\hat{g}}_{M,n}(Z,W) = \hat{Q}^{\star}_Y(m=1, z, w) \hat{g}_{M|a^{\star},W} + \hat{Q}^{\star}_Y(m=0, z, w)(1-\hat{g}_{M|a^{\star},W})\)</span>).</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmpdat</span><span class="op">$</span><span class="va">Qma1g0</span> <span class="op">&lt;-</span> <span class="va">tmpdat</span><span class="op">$</span><span class="va">qyinit</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">gm</span><span class="op">)</span> <span class="op">+</span> <span class="va">tmpdat</span><span class="op">$</span><span class="va">qyinit</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="va">gm</span>
<span class="va">tmpdat</span><span class="op">$</span><span class="va">Qma1g1</span> <span class="op">&lt;-</span> <span class="va">tmpdat</span><span class="op">$</span><span class="va">qyinit</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">gma1</span><span class="op">)</span> <span class="op">+</span> <span class="va">tmpdat</span><span class="op">$</span><span class="va">qyinit</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="va">gma1</span>
<span class="va">tmpdat</span><span class="op">$</span><span class="va">Qma0g0</span> <span class="op">&lt;-</span> <span class="va">tmpdat</span><span class="op">$</span><span class="va">qyinit</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">gm</span><span class="op">)</span> <span class="op">+</span> <span class="va">tmpdat</span><span class="op">$</span><span class="va">qyinit</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="va">gm</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>We now fit a regression of <span class="math inline">\(\bar{Q}^{\hat{g}}_{M,n}(Z,W)\)</span> on <span class="math inline">\(W\)</span>
among those with <span class="math inline">\(A=a^\prime\)</span>. We call the predicted values from this
regression <span class="math inline">\(\hat{\bar{Q}}^{a^\prime}_{Z}(W)\)</span>.</li>
</ol>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Qzfita1g0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>
  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Qma1g0"</span>, <span class="va">qmodel</span>, sep <span class="op">=</span> <span class="st">"~"</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">tmpdat</span><span class="op">[</span><span class="va">tmpdat</span><span class="op">$</span><span class="va">a</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span>, family <span class="op">=</span> <span class="st">"quasibinomial"</span>
<span class="op">)</span>
<span class="va">Qzfita1g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>
  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Qma1g1"</span>, <span class="va">qmodel</span>, sep <span class="op">=</span> <span class="st">"~"</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">tmpdat</span><span class="op">[</span><span class="va">tmpdat</span><span class="op">$</span><span class="va">a</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span>, family <span class="op">=</span> <span class="st">"quasibinomial"</span>
<span class="op">)</span>
<span class="va">Qzfita0g0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>
  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Qma0g0"</span>, <span class="va">qmodel</span>, sep <span class="op">=</span> <span class="st">"~"</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">tmpdat</span><span class="op">[</span><span class="va">tmpdat</span><span class="op">$</span><span class="va">a</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span>, family <span class="op">=</span> <span class="st">"quasibinomial"</span>
<span class="op">)</span>

<span class="va">Qza1g0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Qzfita1g0</span>, type <span class="op">=</span> <span class="st">"response"</span>, newdata <span class="op">=</span> <span class="va">tmpdat</span><span class="op">)</span>
<span class="va">Qza1g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Qzfita1g1</span>, type <span class="op">=</span> <span class="st">"response"</span>, newdata <span class="op">=</span> <span class="va">tmpdat</span><span class="op">)</span>
<span class="va">Qza0g0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Qzfita0g0</span>, type <span class="op">=</span> <span class="st">"response"</span>, newdata <span class="op">=</span> <span class="va">tmpdat</span><span class="op">)</span></code></pre></div>
<p>(Note that if <span class="math inline">\(A\)</span> were not randomly assigned, we would need to complete a
second targeting step.)</p>
<ol start="8" style="list-style-type: decimal">
<li>Take the empirical mean of these predicted values
<span class="math inline">\(\Psi(P)(a^\prime, \hat{g}_{M \mid a^{\star}, W})\)</span>.</li>
</ol>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">meanQza1m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Qza1g0</span><span class="op">)</span>
<span class="va">meanQza1m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Qza1g1</span><span class="op">)</span>
<span class="va">meanQza0m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Qza0g0</span><span class="op">)</span></code></pre></div>
<ol start="9" style="list-style-type: decimal">
<li>
<p>Repeat the above steps for each of the interventions. For example, for
binary <span class="math inline">\(A\)</span>, we would execute these steps a total of three times to
estimate:</p>
<ol style="list-style-type: decimal">
<li>
<span class="math inline">\(\Psi(P)(1,\hat{g}_{M \mid 1, W})\)</span>,</li>
<li>
<span class="math inline">\(\Psi(P)(1,\hat{g}_{M \mid 0, W})\)</span>, and</li>
<li>
<span class="math inline">\(\Psi(P)(0,\hat{g}_{M \mid 0, W})\)</span>.</li>
</ol>
</li>
<li><p>Plug in all of the nuisance parameter estimates to the EIC, set it equal to zero and solve. This is the one-step estimate of the PIDE and PIIE.</p></li>
<li><p>The variance can be estimated as the sample variance of the EIF (defined
above) divided by <span class="math inline">\(n\)</span>.</p></li>
</ol>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="estimating-natural-and-interventional-effects.html#cb22-1"></a><span class="co"># first get EIF</span></span>
<span id="cb22-2"><a href="estimating-natural-and-interventional-effects.html#cb22-2"></a>eic1a1g0 &lt;-<span class="st"> </span>tmpdat<span class="op">$</span>ha1gma0 <span class="op">*</span><span class="st"> </span>(tmpdat<span class="op">$</span>y <span class="op">-</span><span class="st"> </span>tmpdat<span class="op">$</span>qyinit[,<span class="dv">1</span>])</span>
<span id="cb22-3"><a href="estimating-natural-and-interventional-effects.html#cb22-3"></a>eic2a1g0 &lt;-<span class="st"> </span>psa1 <span class="op">*</span><span class="st"> </span>(tmpdat<span class="op">$</span>Qma1g0 <span class="op">-</span><span class="st"> </span>Qza1g0)</span>
<span id="cb22-4"><a href="estimating-natural-and-interventional-effects.html#cb22-4"></a>eic3a1g0 &lt;-<span class="st"> </span>Qza1g0 <span class="op">-</span><span class="st"> </span>meanQza1m0</span>
<span id="cb22-5"><a href="estimating-natural-and-interventional-effects.html#cb22-5"></a>eica1g0 &lt;-<span class="st"> </span>eic1a1g0 <span class="op">+</span><span class="st"> </span>eic2a1g0 <span class="op">+</span><span class="st"> </span>eic3a1g0</span>
<span id="cb22-6"><a href="estimating-natural-and-interventional-effects.html#cb22-6"></a></span>
<span id="cb22-7"><a href="estimating-natural-and-interventional-effects.html#cb22-7"></a>eic1a1g1 &lt;-<span class="st"> </span>tmpdat<span class="op">$</span>ha1gma1 <span class="op">*</span><span class="st"> </span>(tmpdat<span class="op">$</span>y <span class="op">-</span><span class="st"> </span>tmpdat<span class="op">$</span>qyinit[,<span class="dv">1</span>])</span>
<span id="cb22-8"><a href="estimating-natural-and-interventional-effects.html#cb22-8"></a>eic2a1g1 &lt;-<span class="st"> </span>psa1 <span class="op">*</span><span class="st"> </span>(tmpdat<span class="op">$</span>Qma1g1 <span class="op">-</span><span class="st"> </span>Qza1g1)</span>
<span id="cb22-9"><a href="estimating-natural-and-interventional-effects.html#cb22-9"></a>eic3a1g1 &lt;-<span class="st"> </span>Qza1g1 <span class="op">-</span><span class="st"> </span>meanQza1m1</span>
<span id="cb22-10"><a href="estimating-natural-and-interventional-effects.html#cb22-10"></a>eica1g1 &lt;-<span class="st"> </span>eic1a1g1 <span class="op">+</span><span class="st"> </span>eic2a1g1 <span class="op">+</span><span class="st"> </span>eic3a1g1</span>
<span id="cb22-11"><a href="estimating-natural-and-interventional-effects.html#cb22-11"></a></span>
<span id="cb22-12"><a href="estimating-natural-and-interventional-effects.html#cb22-12"></a>eic1a0g0 &lt;-<span class="st"> </span>tmpdat<span class="op">$</span>ha0gma0 <span class="op">*</span><span class="st"> </span>(tmpdat<span class="op">$</span>y <span class="op">-</span><span class="st"> </span>tmpdat<span class="op">$</span>qyinit[,<span class="dv">1</span>)</span>
<span id="cb22-13"><a href="estimating-natural-and-interventional-effects.html#cb22-13"></a>eic2a0g0 &lt;-<span class="st"> </span>psa0 <span class="op">*</span><span class="st"> </span>(tmpdat<span class="op">$</span>Qma0g0 <span class="op">-</span><span class="st"> </span>Qza0g0)</span>
<span id="cb22-14"><a href="estimating-natural-and-interventional-effects.html#cb22-14"></a>eic3a0g0 &lt;-<span class="st"> </span>Qzupa0g0 <span class="op">-</span><span class="st"> </span>meanQza0m0</span>
<span id="cb22-15"><a href="estimating-natural-and-interventional-effects.html#cb22-15"></a>eica0g0 &lt;-<span class="st"> </span>eic1a0g0 <span class="op">+</span><span class="st"> </span>eic2a0g0 <span class="op">+</span><span class="st"> </span>eic3a0g0</span>
<span id="cb22-16"><a href="estimating-natural-and-interventional-effects.html#cb22-16"></a></span>
<span id="cb22-17"><a href="estimating-natural-and-interventional-effects.html#cb22-17"></a>pide &lt;-<span class="st"> </span><span class="kw">mean</span>(eica1g0 <span class="op">-</span><span class="st"> </span>eica0g0)</span>
<span id="cb22-18"><a href="estimating-natural-and-interventional-effects.html#cb22-18"></a>piie &lt;-<span class="st"> </span><span class="kw">mean</span>(eica1g1 <span class="op">-</span><span class="st"> </span>eica1g0)</span>
<span id="cb22-19"><a href="estimating-natural-and-interventional-effects.html#cb22-19"></a></span>
<span id="cb22-20"><a href="estimating-natural-and-interventional-effects.html#cb22-20"></a><span class="co"># estimands</span></span>
<span id="cb22-21"><a href="estimating-natural-and-interventional-effects.html#cb22-21"></a>pideeic &lt;-<span class="st"> </span>eica1g0 <span class="op">-</span><span class="st"> </span>eica0g0</span>
<span id="cb22-22"><a href="estimating-natural-and-interventional-effects.html#cb22-22"></a>vareic &lt;-<span class="st"> </span><span class="kw">var</span>(pideeic) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(tmpdat)</span>
<span id="cb22-23"><a href="estimating-natural-and-interventional-effects.html#cb22-23"></a></span>
<span id="cb22-24"><a href="estimating-natural-and-interventional-effects.html#cb22-24"></a>piieeic &lt;-<span class="st"> </span>eica1g1 <span class="op">-</span><span class="st"> </span>eica1g0</span>
<span id="cb22-25"><a href="estimating-natural-and-interventional-effects.html#cb22-25"></a>varpiieeic &lt;-<span class="st"> </span><span class="kw">var</span>(piieeic) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(tmpdat)</span></code></pre></div>
<!--12. The PIDE can then be obtained by substituting estimates of parameters
    $\Psi(P)(a,\hat{g}_{M \mid a^{\star}, W}) -
    \Psi(P)(a^{\star},\hat{g}_{M \mid a^{\star}, W})$ and the PIIE
    can be obtained by substituting estimates of parameters
    $\Psi(P)(a,\hat{g}_{M \mid a,W}) -
    \Psi(P)(a, \hat{g}_{M \mid a^{\star}, W})$.


```r
nde <- tmlea1m0 - tmlea0m0
nie <- tmlea1m1 - tmlea1m0
```
-->
</div>
</div>
<div id="the-general-case" class="section level2">
<h2>
<span class="header-section-number">6.4</span> The general case<a class="anchor" aria-label="anchor" href="#the-general-case"><i class="fas fa-link"></i></a>
</h2>
<p>Actually, we would want to have the fixed parameter with the true, unknown
<span class="math inline">\(g_{M \mid a, W}\)</span> and would like <span class="math inline">\(M\)</span> to be continuous/multi-dimensional.</p>
<p>This is a pain to do by hand, but Nima made an easy-to-use package for all of us
called <a href="https://github.com/nhejazi/medoutcon">medoutcon</a>! He will go through
this next.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="preliminaries-on-semiparametric-estimation.html"><span class="header-section-number">5</span> Preliminaries on semiparametric estimation</a></div>
<div class="next"><a href="estimating-stochastic-effects.html"><span class="header-section-number">7</span> Estimating stochastic effects</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#estimating-natural-and-interventional-effects"><span class="header-section-number">6</span> Estimating natural and interventional effects</a></li>
<li>
<a class="nav-link" href="#natural-indirect-effects"><span class="header-section-number">6.1</span> Natural (in)direct effects</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#simple-case-for-intuition"><span class="header-section-number">6.1.1</span> Simple case for intuition</a></li>
<li><a class="nav-link" href="#how-to-estimate-using-g-computation"><span class="header-section-number">6.1.2</span> How to estimate using G-computation</a></li>
<li><a class="nav-link" href="#how-to-estimate-using-the-doubly-robust-methods-that-rely-on-the-eif"><span class="header-section-number">6.1.3</span> How to estimate using the doubly robust methods that rely on the EIF</a></li>
<li><a class="nav-link" href="#how-to-estimate-using-the-one-step-estimator-essentially-a-iptw"><span class="header-section-number">6.1.4</span> How to estimate using the one-step estimator (essentially A-IPTW)</a></li>
</ul>
</li>
<li><a class="nav-link" href="#interventional-direct-and-indirect-effects"><span class="header-section-number">6.2</span> Interventional direct and indirect effects</a></li>
<li>
<a class="nav-link" href="#simple-case-for-intuition-1"><span class="header-section-number">6.3</span> Simple case for intuition</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#estimation-using-g-computation"><span class="header-section-number">6.3.1</span> Estimation using G-Computation</a></li>
<li><a class="nav-link" href="#estimate-with-doubly-robust-methods-based-on-the-eif"><span class="header-section-number">6.3.2</span> Estimate with doubly robust methods based on the EIF</a></li>
</ul>
</li>
<li><a class="nav-link" href="#the-general-case"><span class="header-section-number">6.4</span> The general case</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/nhejazi/ser2021_mediation_workshop/blob/master/06-estimation-natural-interventional.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/nhejazi/ser2021_mediation_workshop/edit/master/06-estimation-natural-interventional.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>[SER 2021 Workshop] Causal Mediation: Modern Methods for Path Analysis</strong>" was written by Iván Díaz, Nima Hejazi, Kara Rudolph. It was last built on updated: May 07, 2021.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
